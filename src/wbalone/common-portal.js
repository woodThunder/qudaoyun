window.___jsl=window.___jsl||{},(window.___jsl.ci=window.___jsl.ci||[]).push({opensocial:{invalidatePath:"//%host%/portal/rpc",path:"//%host%/portal/rpc",domain:"shindig",supportedFields:{person:["id",{name:["familyName","givenName","unstructured"]},"thumbnailUrl","profileUrl"],mediaItem:"album_id created description duration file_size id language last_updated location mime_type num_comments num_views num_votes rating start_time tagged_people tags thumbnail_url title type url".split(" "),album:"id thumbnailUrl title description location ownerId".split(" "),group:["id","title","description"],activity:"appId body bodyId externalId id mediaItems postedTime priority streamFaviconUrl streamSourceUrl streamTitle streamUrl templateParams title url userId".split(" "),activityEntry:"actor content generator icon id object published provider target title updated url verb openSocial extensions".split(" ")},enableCaja:!1},rpc:{commSwf:"/xpc.swf",passReferrer:"c2p:query",parentRelayUrl:"/container/rpc_relay.html",useLegacyProtocol:!1},"shindig.auth":{authToken:"-1:-1:*:*:*:0:default"},container:{jsPath:"/portal/gadgets/js",relayPath:"/portal/gadgets/files/container/rpc_relay.html",enableRpcArbitration:!1},views:{"default":{isOnlyVisible:!1,urlTemplate:"http://localhost/portal/gadgets/default?{var}",aliases:["home","profile","canvas"]},canvas:{isOnlyVisible:!0,urlTemplate:"http://localhost/portal/gadgets/canvas?{var}",aliases:["FULL_PAGE"]},embedded:{isOnlyVisible:!1,urlTemplate:"http://localhost/portal/gadgets/embedded?{var}",aliases:["embedded"]},profile:{isOnlyVisible:!1,urlTemplate:"http://localhost/portal/gadgets/profile?{var}",aliases:["DASHBOARD","default"]}},osapi:{endPoints:["//%host%/portal/rpc"]},"osapi.services":{"gadgets.rpc":["container.listMethods"]},"core.io":{unparseableCruft:"throw 1; < don't be evil' >",jsonProxyUrl:"//%host%/portal/gadgets/makeRequest",jsPath:"/portal/gadgets/js",proxyUrl:"//%host%/portal/gadgets/proxy%filename%?container=%container%&refresh=%refresh%&url=%url%%authz%%rewriteMime%",xhrPollIntervalMs:50}}),window.___jsl=window.___jsl||{},window.___jsl.f=["auth-refresh","container","container.site","container.site.gadget","container.site.url","container.util","core.config","core.config.base","core.io","core.json","core.log","core.prefs","core.util","core.util.base","core.util.dom","core.util.event","core.util.onload","core.util.string","core.util.urlparams","domnode","embedded-experiences","gadgets.json.ext","globals","locked-domain","open-views","open-views.common","open-views.ee","open-views.gadget","open-views.results","open-views.url","opensocial","opensocial-base","opensocial-data-context","opensocial-jsonrpc","opensocial-reference","osapi","osapi.base","portal","rpc","security-token","shindig.auth","shindig.uri","shindig.uri.ext","taming","views","xmlutil"],gadgets=window.gadgets||{},shindig=window.shindig||{},osapi=window.osapi||{};var safeJSON=window.safeJSON,tamings___=window.tamings___||[],bridge___,caja___=window.caja___,___=window.___,DOM_ELEMENT_NODE=1,DOM_ATTRIBUTE_NODE=2,DOM_TEXT_NODE=3,DOM_CDATA_SECTION_NODE=4,DOM_ENTITY_REFERENCE_NODE=5,DOM_ENTITY_NODE=6,DOM_PROCESSING_INSTRUCTION_NODE=7,DOM_COMMENT_NODE=8,DOM_DOCUMENT_NODE=9,DOM_DOCUMENT_TYPE_NODE=10,DOM_DOCUMENT_FRAGMENT_NODE=11,DOM_NOTATION_NODE=12;gadgets.log=function(){function e(e,t){"undefined"==typeof n&&(n=window.console?window.console:window.opera?window.opera.postError:null),e<i||!n||(2===e&&n.warn?n.warn(t):3===e&&n.error?n.error(t):n.log&&n.log(t))}var t=function(t){e(1,t)};gadgets.warn=function(t){e(2,t)},gadgets.error=function(t){e(3,t)},gadgets.setLogLevel=function(e){i=e},t.INFO=1,t.WARNING=2,t.NONE=4;var n,i=1;return t}(),window.gadgets.config||(gadgets.config=function(){function e(t,n){for(var i in n)n.hasOwnProperty(i)&&("object"==typeof t[i]&&"object"==typeof n[i]?e(t[i],n[i]):t[i]=n[i])}function t(e){var n="";if(e.nodeType==DOM_TEXT_NODE||e.nodeType==DOM_CDATA_SECTION_NODE)n=e.nodeValue;else if(e.innerText)n=e.innerText;else if(e.innerHTML)n=e.innerHTML;else if(e.firstChild){for(n=[],e=e.firstChild;e;e=e.nextSibling)n.push(t(e));n=n.join("")}return n}function n(n){var i=(o["core.io"]||{}).jsPath||null,a=[],s=0,c=document.scripts||document.getElementsByTagName("script");if(c&&0!=c.length){for(var l=0;l<c.length;++l){var d=c[l].src,u=null!=i&&d&&d.indexOf(i)||-1;-1!=u&&/.*[.]js.*[?&]c=[01](#|&|$).*/.test(d.substring(u+i.length))&&(a[s++]=c[l])}a.length||(i=c[c.length-1],i.src&&(a[0]=i))}if(a.length)for(i=0;i<a.length;i++){s=t(a[i]),c=void 0;try{c=new Function("return ("+s+"\n)")()}catch(p){}if("object"==typeof c)s=c;else{try{c=new Function("return ({"+s+"\n})")()}catch(g){}s="object"==typeof c?c:{}}r.f&&1==r.f.length&&!s[r.f[0]]&&(c={},c[r.f[0]]=s,s=c),e(n,s),(s=window.___cfg)&&e(n,s)}}function i(e){for(var t in a)if(a.hasOwnProperty(t))for(var n=a[t],i=0,r=n.length;i<r;++i)e(t,n[i])}var r,a={},o={},s=!1;return{register:function(e,t,n,i){var r=a[e];r||(r=[],a[e]=r),r.push({validators:t||{},callback:n,callOnUpdate:i}),s&&n&&n(o)},get:function(e){return e?o[e]||{}:o},init:function(t,a){r=window.___jsl||{},e(o,t),n(o),e(o,window.___config||{}),i(function(e,t){var n=o[e];if(n&&!a){var i,r=t.validators;for(i in r)if(r.hasOwnProperty(i)&&!r[i](n[i]))throw Error('Invalid config value "'+n[i]+'" for parameter "'+i+'" in component "'+e+'"')}t.callback&&t.callback(o)}),s=!0},update:function(t,n){var r=[];i(function(e,i){(t.hasOwnProperty(e)||n&&o&&o[e])&&i.callback&&i.callOnUpdate&&r.push(i.callback)}),o=n?{}:o||{},e(o,t);for(var a=0,s=r.length;a<s;++a)r[a](o)},clear:function(){gadgets.warn("This method is for testing."),r=void 0,o={},s=!1}}}()),gadgets.util=gadgets.util||{},function(){var e=null;gadgets.util.getUrlParameters=function(t){var n="undefined"==typeof t;if(null!==e&&n)return e;var i={};t=t||document.location.href;var r=t.indexOf("?"),a=t.indexOf("#");t=(-1===a?t.substr(r+1):[t.substr(r+1,a-r-1),"&",t.substr(a+1)].join("")).split("&");for(var r=window.decodeURIComponent?decodeURIComponent:unescape,a=0,o=t.length;a<o;++a){var s=t[a].indexOf("=");if(-1!==s){var c=t[a].substring(0,s),s=t[a].substring(s+1),s=s.replace(/\+/g," ");try{i[c]=r(s)}catch(l){}}}return n&&(e=i),i}}(),gadgets.util.getUrlParameters(),gadgets.util=gadgets.util||{},gadgets.util.attachBrowserEvent=function(e,t,n,i){"undefined"!=typeof e.addEventListener?e.addEventListener(t,n,i):"undefined"!=typeof e.attachEvent?e.attachEvent("on"+t,n):gadgets.warn("cannot attachBrowserEvent: "+t)},gadgets.util.removeBrowserEvent=function(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent?e.detachEvent("on"+t,n):gadgets.warn("cannot removeBrowserEvent: "+t)},function(){gadgets.config.EnumValidator=function(e){var t=[];if(1<arguments.length)for(var n,i=0;n=arguments[i];++i)t.push(n);else t=e;return function(e){for(var n=0;t[n];++n)if(e===t[n])return!0;return!1}},gadgets.config.RegExValidator=function(e){return function(t){return e.test(t)}},gadgets.config.ExistsValidator=function(e){return"undefined"!=typeof e},gadgets.config.NonEmptyStringValidator=function(e){return"string"==typeof e&&0<e.length},gadgets.config.BooleanValidator=function(e){return"boolean"==typeof e},gadgets.config.LikeValidator=function(e){return function(t){for(var n in e)if(e.hasOwnProperty(n)&&!(0,e[n])(t[n]))return!1;return!0}}}(),gadgets.util=gadgets.util||{},gadgets.util.makeClosure=function(e,t,n){for(var i=[],r=2,a=arguments.length;r<a;++r)i.push(arguments[r]);return function(){for(var n=i.slice(),r=0,a=arguments.length;r<a;++r)n.push(arguments[r]);return t.apply(e,n)}},gadgets.util.makeEnum=function(e){var t,n,i={};for(t=0;n=e[t];++t)i[n]=n;return i},gadgets.util.shouldPollXhrReadyStateChange=function(){return!(!document.all||document.querySelector)},gadgets.util=gadgets.util||{},function(){gadgets.util.createElement=function(e){var t;if(!document.body||document.body.namespaceURI)try{t=document.createElementNS("http://www.w3.org/1999/xhtml",e)}catch(n){}return t||document.createElement(e)},gadgets.util.createIframeElement=function(e){var t=gadgets.util.createElement("iframe");try{var n,i,r=["<","iframe"],a=e||{};for(i in a)a.hasOwnProperty(i)&&(r.push(" "),r.push(i),r.push('="'),r.push(gadgets.util.escapeString(a[i])),r.push('"'));r.push("></"),r.push("iframe"),r.push(">"),n=r.join("");var o=gadgets.util.createElement(n);o&&(!t||o.tagName==t.tagName&&o.namespaceURI==t.namespaceURI)&&(t=o)}catch(s){}n=t,e=e||{};for(var c in e)e.hasOwnProperty(c)&&(n[c]=e[c]);return t},gadgets.util.getBodyElement=function(){if(document.body)return document.body;try{var e=document.getElementsByTagNameNS("http://www.w3.org/1999/xhtml","body");if(e&&1==e.length)return e[0]}catch(t){}return document.documentElement||document}}(),gadgets.util=gadgets.util||{},function(){var e=[];gadgets.util.registerOnLoadHandler=function(t){e.push(t)},gadgets.util.runOnLoadHandlers=function(){if(gadgets.util.registerOnLoadHandler=function(e){e()},e){for(var t=0,n=e.length;t<n;++t)try{e[t]()}catch(i){gadgets.warn("Could not fire onloadhandler "+i.message)}e=void 0}},function(){gadgets.util.attachBrowserEvent(document,"DOMContentLoaded",gadgets.util.runOnLoadHandlers,!1);var e=window.onload;window.onload=function(){e&&e(),gadgets.util.runOnLoadHandlers()};var t="";if(window&&window.location&&window.location.href&&(t=gadgets.util.getUrlParameters(window.location.href).libs),t=/(?:js\/)([^&|\.]+)/g.exec(t))for(var t=decodeURIComponent(t[1]),n=document.getElementsByTagName("script")||[],i=0;i<n.length;i++){var r=n[i],a=r.src;if(a&&t&&-1!==a.indexOf(t)){var o=r.onload;r.onload=function(){o&&o(),gadgets.util.runOnLoadHandlers()}}}}()}(),gadgets.util=gadgets.util||{},function(){function e(e,t){return String.fromCharCode(t)}var t={0:!1,10:!0,13:!0,34:!0,39:!0,60:!0,62:!0,92:!0,8232:!0,8233:!0,65282:!0,65287:!0,65308:!0,65310:!0,65340:!0};gadgets.util.escape=function(e,t){if(e){if("string"==typeof e)return gadgets.util.escapeString(e);if("array"==typeof e)for(var n=0,i=e.length;n<i;++n)e[n]=gadgets.util.escape(e[n]);else if("object"==typeof e&&t){n={};for(i in e)e.hasOwnProperty(i)&&(n[gadgets.util.escapeString(i)]=gadgets.util.escape(e[i],!0));return n}}return e},gadgets.util.escapeString=function(e){if(!e)return e;for(var n,i,r=[],a=0,o=e.length;a<o;++a)n=e.charCodeAt(a),i=t[n],!0===i?r.push("&#",n,";"):!1!==i&&r.push(e.charAt(a));return r.join("")},gadgets.util.unescapeString=function(t){return t?t.replace(/&#([0-9]+);/g,e):t}}(),gadgets.util=gadgets.util||{},function(){function e(e){e=(e=e["core.io"])&&e.jsPath;for(var t=document.getElementsByTagName("script"),i=0;e&&i<t.length;i++){var r=t[i].src;if(r&&-1<r.indexOf(e))return n="1"==gadgets.util.getUrlParameters(r).debug}n=!1}function t(e){i=e["core.util"]||{}}var n,i={},r={};gadgets.config&&(gadgets.config.register("core.util",null,t),gadgets.config.register("core.io",void 0,e,e)),gadgets.util.getFeatureParameters=function(e){return"undefined"==typeof i[e]?null:i[e]},gadgets.util.hasFeature=function(e){return"undefined"!=typeof i[e]},gadgets.util.getServices=function(){return r},gadgets.util.isDebug=function(){return n}}(),window.JSON&&window.JSON.parse&&window.JSON.stringify&&(gadgets.json=function(){function e(e,t){return this[e]}var t=/___$/;return{parse:function(e){try{return window.JSON.parse(e)}catch(t){return!1}},stringify:function(n){function i(t){return r.call(this,t,e)}var r=window.JSON.stringify,a=Array.prototype.toJSON&&'"[{\\"x\\": 1}]"'===r([{x:1}])?i:r;try{return a(n,function(e,n){return t.test(e)?void 0:n})}catch(o){return null}}}}()),window.JSON&&window.JSON.parse&&window.JSON.stringify||(gadgets.json=function(){function c(e){return 10>e?"0"+e:e}function e(t){var n,i,r;switch(n=/[\"\\\x00-\x1f\x7f-\x9f]/g,typeof t){case"string":return n.test(t)?'"'+t.replace(n,function(e){var t=f[e];return t?t:(t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))})+'"':'"'+t+'"';case"number":return isFinite(t)?String(t):"null";case"boolean":case"null":return String(t);case"object":if(!t)return"null";if(n=[],"number"==typeof t.length&&!t.propertyIsEnumerable("length")){for(r=t.length,i=0;i<r;i+=1)n.push(e(t[i])||"null");return"["+n.join(",")+"]"}for(i in t)!/___$/.test(i)&&t.hasOwnProperty(i)&&"string"==typeof i&&(r=e(t[i]))&&n.push(e(i)+":"+r);return"{"+n.join(",")+"}"}return""}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",c(this.getUTCMonth()+1),"-",c(this.getUTCDate()),"T",c(this.getUTCHours()),":",c(this.getUTCMinutes()),":",c(this.getUTCSeconds()),"Z"].join("")};var f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:e,parse:function(a){return!!/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&eval("("+a+")")}}}()),gadgets.json.flatten=function(e){var t={};if(null===e||"undefined"==typeof e)return t;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];null!==i&&"undefined"!=typeof i&&(t[n]="string"==typeof i?i:gadgets.json.stringify(i))}return t},shindig.Auth=function(){function g(e){for(var t=c.split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if(2===i.length){var r=i[0],i=i[1];"$"===i&&(i=encodeURIComponent(e[r]),t[n]=r+"="+i)}}c=t.join("&")}var c=null,e=null;return gadgets.config.register("shindig.auth",null,function(a){var b=gadgets.util.getUrlParameters();a=a["shindig.auth"]||{},a.authToken?c=a.authToken:b.st&&(c=b.st),null!==c&&g(b),a.trustedJson&&(e=eval("("+a.trustedJson+")"))}),{getSecurityToken:function(){return c},updateSecurityToken:function(e){c=e},getTrustedData:function(){return e}}},shindig.auth=new shindig.Auth,gadgets.rpctx=gadgets.rpctx||{},gadgets.rpctx.wpm||(gadgets.rpctx.wpm=function(){function e(e,t,n){"undefined"!=typeof window.addEventListener?window.addEventListener(e,t,n):"undefined"!=typeof window.attachEvent&&window.attachEvent("on"+e,t)}function t(e){var t=gadgets.json.parse(e.data);if(t&&t.f){var i=gadgets.rpc.getTargetOrigin(t.f);r&&("undefined"!=typeof e.origin?e.origin!==i:e.domain!==/^.+:\/\/([^:]+).*/.exec(i)[1])||n(t,e.origin)}}var n,i,r=!0;return{getCode:function(){return"wpm"},isParentVerifiable:function(){return!0},init:function(a,o){return gadgets.config.register("rpc",null,function(e){"true"===String((e?e.rpc:{}).disableForceSecure)&&(r=!1)}),n=a,i=o,e("message",t,!1),i("..",!0),!0},setup:function(e,t){return i(e,!0),!0},call:function(e,t,n){var i=gadgets.rpc.getTargetOrigin(e),r=gadgets.rpc._getTargetWin(e);return i?window.setTimeout(function(){r.postMessage(gadgets.json.stringify(n),i)},0):gadgets.error("No relay set (used as window.postMessage targetOrigin), cannot send cross-domain message"),!0}}}()),gadgets.rpctx=gadgets.rpctx||{},gadgets.rpctx.flash||(gadgets.rpctx.flash=function(){function e(e,t){return P[t]=P[t]||function(){e.apply({},arguments)},l+"."+t}function t(){if(null===h&&document.body&&u){var e=u+"?cb="+Math.random()+"&origin="+N+"&jsl=1",n=document.createElement("div");n.style.height="1px",n.style.width="1px",e='<object height="1" width="1" id="'+d+'" type="application/x-shockwave-flash"><param name="allowScriptAccess" value="always"></param><param name="movie" value="'+e+'"></param><embed type="application/x-shockwave-flash" allowScriptAccess="always" src="'+e+'" height="1" width="1"></embed></object>',document.body.appendChild(n),n.innerHTML=e,h=n.firstChild}++w,null!==y&&(null!==h||w>=m)?window.clearTimeout(y):y=window.setTimeout(t,_)}function n(){A[".."]||(c(".."),I++,I>=S&&null!==O?(window.clearTimeout(O),O=null):O=window.setTimeout(n,b))}function i(){if(null!==h&&h.setup){for(;0<E.length;){var e=E.shift(),t=e.targetId;h.setup(e.token,".."===t?gadgets.rpc.RPC_ID:t,".."===t?"INNER":"OUTER")}null!==v&&(window.clearTimeout(v),v=null)}else null===v&&0<E.length&&(v=window.setTimeout(i,T))}function r(){i(),null!==y&&window.clearTimeout(y),y=null}function a(){A[".."]||null!==O||(O=window.setTimeout(n,b))}function o(e,t,n){t=gadgets.rpc.getTargetOrigin(e);var i=gadgets.rpc.getAuthToken(e);return h["sendMessage_"+(".."===e?gadgets.rpc.RPC_ID:e)+"_"+i+"_"+(".."===e?"INNER":"OUTER")].call(h,gadgets.json.stringify(n),t),!0}function s(e,t,n){var i=gadgets.json.parse(e);(e=i[R])?(f(e,!0),A[e]=!0,".."!==e&&c(e,!0)):window.setTimeout(function(){g(i,t)},0)}function c(e,t){var n=gadgets.rpc.RPC_ID,i={};i[R]=t?"..":n,i[C]=n,o(e,n,i)}var l,d="___xpcswf",u=null,p=!1,g=null,f=null,h=null,_=100,m=50,E=[],v=null,T=500,y=null,w=0,R="_scr",C="_pnt",b=100,S=50,I=0,O=null,A={},N=window.location.protocol+"//"+window.location.host,P=function(){window.___jsl=window.___jsl||{};var e=window.___jsl._fm={};return l="___jsl._fm",e}();return gadgets.config.register("rpc",null,function(e){p&&(u=e.rpc.commSwf||"//xpc.googleusercontent.com/gadgets/xpc.swf")}),e(r,"ready"),e(a,"setupDone"),e(s,"receiveMessage"),{getCode:function(){return"flash"},isParentVerifiable:function(){return!0},init:function(e,t){return g=e,f=t,p=!0},setup:function(e,n){return E.push({token:n,targetId:e}),null===h&&null===y&&(y=window.setTimeout(t,_)),i(),!0},call:o,_receiveMessage:s,_ready:r,_setupDone:a}}()),gadgets.rpctx=gadgets.rpctx||{},gadgets.rpctx.frameElement||(gadgets.rpctx.frameElement=function(){function e(e,n,a){try{if(".."!==n){var o=window.frameElement;if("function"==typeof o[i])return"function"!=typeof o[i][r]&&(o[i][r]=function(e){t(gadgets.json.parse(e))}),o[i](gadgets.json.stringify(a)),!0}else{var s=document.getElementById(e);if("function"==typeof s[i]&&"function"==typeof s[i][r])return s[i][r](gadgets.json.stringify(a)),!0}}catch(c){}return!1}var t,n,i="__g2c_rpc",r="__c2g_rpc";return{getCode:function(){return"fe"},isParentVerifiable:function(){return!1},init:function(e,i){return t=e,n=i,!0},setup:function(e,r){if(".."!==e)try{document.getElementById(e)[i]=function(e){t(gadgets.json.parse(e))}}catch(a){return!1}return".."===e&&(n("..",!0),gadgets.util.registerOnLoadHandler(function(){window.setTimeout(function(){gadgets.rpc.call(e,gadgets.rpc.ACK)},500)})),!0},call:function(t,n,i){return e(t,n,i)}}}()),gadgets.rpctx=gadgets.rpctx||{},gadgets.rpctx.nix||(gadgets.rpctx.nix=function(){function e(){var s=a[".."];if(!s)if(++o>i)gadgets.warn("Nix transport setup failed, falling back..."),t("..",!1);else{if(!s&&window.opener&&"GetAuthToken"in window.opener&&(s=window.opener,s.GetAuthToken()==gadgets.rpc.getAuthToken(".."))){var c=gadgets.rpc.getAuthToken("..");return s.CreateChannel(window[n]("..",c),c),a[".."]=s,window.opener=null,void t("..",!0)}window.setTimeout(function(){e()},r)}}var t,n="GRPC____NIXVBS_get_wrapper",i=10,r=500,a={},o=0;return{getCode:function(){return"nix"},isParentVerifiable:function(){return!1},init:function(e,i){if(t=i,"unknown"!=typeof window[n]){window.GRPC____NIXVBS_handle_message=function(t){window.setTimeout(function(){e(gadgets.json.parse(t))},0)},window.GRPC____NIXVBS_create_channel=function(e,n,i){gadgets.rpc.getAuthToken(e)===i&&(a[e]=n,t(e,!0))};var r="Class GRPC____NIXVBS_wrapper\n Private m_Intended\nPrivate m_Auth\nPublic Sub SetIntendedName(name)\n If isEmpty(m_Intended) Then\nm_Intended = name\nEnd If\nEnd Sub\nPublic Sub SetAuth(auth)\n If isEmpty(m_Auth) Then\nm_Auth = auth\nEnd If\nEnd Sub\nPublic Sub SendMessage(data)\n GRPC____NIXVBS_handle_message(data)\nEnd Sub\nPublic Function GetAuthToken()\n GetAuthToken = m_Auth\nEnd Function\nPublic Sub CreateChannel(channel, auth)\n Call GRPC____NIXVBS_create_channel(m_Intended, channel, auth)\nEnd Sub\nEnd Class\nFunction "+n+"(name, auth)\nDim wrap\nSet wrap = New GRPC____NIXVBS_wrapper\nwrap.SetIntendedName name\nwrap.SetAuth auth\nSet "+n+" = wrap\nEnd Function";try{window.execScript(r,"vbscript")}catch(o){return!1}}return!0},setup:function(t,i){if(".."===t)return e(),!0;try{var r=document.getElementById(t),a=window[n](t,i);r.contentWindow.opener=a}catch(o){return!1}return!0},call:function(e,t,n){try{a[e]&&a[e].SendMessage(gadgets.json.stringify(n))}catch(i){return!1}return!0}}}()),gadgets.rpctx=gadgets.rpctx||{},gadgets.rpctx.rmr||(gadgets.rpctx.rmr=function(){function e(e,t,n,i){var a=function(){document.body.appendChild(e),e.src="about:blank",i&&(e.onload=function(){r(i)}),e.src=t+"#"+n};document.body?a():gadgets.util.registerOnLoadHandler(function(){a()})}function t(e){var n=null;d[e].searchCounter++;try{var i=gadgets.rpc._getTargetWin(e),n=".."===e?i.frames["rmrtransport-"+gadgets.rpc.RPC_ID]:i.frames["rmrtransport-.."]}catch(r){}i=!1,n&&(i=a(e,n)),i||d[e].searchCounter>l||window.setTimeout(function(){t(e)},c)}function n(e,t,n,r){var a=null;if(a=".."!==n?d[".."]:d[e]){if(t!==gadgets.rpc.ACK&&a.queue.push(r),a.waiting||0===a.queue.length&&(t!==gadgets.rpc.ACK||!r||!0!==r.ackAlone))return!0;0<a.queue.length&&(a.waiting=!0),e=a.relayUri+"#"+i(e);try{a.frame.contentWindow.location=e;var o=10==a.width?20:10;a.frame.style.width=o+"px",a.width=o}catch(s){return!1}}return!0}function i(e){e=d[e];var t={id:e.sendId};if(e){t.d=Array.prototype.slice.call(e.queue,0);var n={s:gadgets.rpc.ACK,id:e.recvId};e.originVerified||(n.sendToken=e.verifySendToken),e.verifyRecvToken&&(n.recvToken=e.verifyRecvToken),t.d.push(n)}return gadgets.json.stringify(t)}function r(e){for(var t=d[e],i=t.receiveWindow.location.hash.substring(1),r=gadgets.json.parse(decodeURIComponent(i))||{},i=r.d||[],a=!1,c=!1,l=0,r=t.recvId-r.id,u=0;u<i.length;++u){var p=i[u];if(p.s===gadgets.rpc.ACK){s(e,!0),t.verifyRecvToken=p.sendToken,!t.originVerified&&p.recvToken&&String(p.recvToken)==String(t.verifySendToken)&&(t.originVerified=!0),t.waiting&&(c=!0),t.waiting=!1;var g=Math.max(0,p.id-t.sendId);t.queue.splice(0,g),t.sendId=Math.max(t.sendId,p.id||0)}else a=!0,++l<=r||(++t.recvId,o(p,t.originVerified?t.relayOrigin:void 0))}(a||c&&0<t.queue.length)&&n(e,gadgets.rpc.ACK,".."===e?gadgets.rpc.RPC_ID:"..",{ackAlone:a})}function a(t,n){function a(){r(t)}var o=d[t];try{var s=!1,s="document"in n;if(!s)return!1;if(s="object"==typeof n.document,!s||"about:blank"===n.location.href)return!1}catch(c){return!1}return o.receiveWindow=n,"undefined"==typeof n.attachEvent?n.onresize=a:n.attachEvent("onresize",a),".."===t?e(o.frame,o.relayUri,i(t),t):r(t),!0}var o,s,c=500,l=10,d={},u=gadgets.util.getUrlParameters().parent;return{getCode:function(){return"rmr"},isParentVerifiable:function(){return!0},init:function(e,t){return o=e,s=t,!0},setup:function(n,r){try{if("object"!=typeof d[n]){var a=document.createElement("iframe"),o=a.style;o.position="absolute",o.top="0px",o.border="0",o.opacity="0",o.width="10px",o.height="1px",a.id="rmrtransport-"+n,a.name=a.id;var s=gadgets.rpc.getRelayUrl(n),c=gadgets.rpc.getOrigin(u);s||(s=c+"/robots.txt"),d[n]={frame:a,receiveWindow:null,relayUri:s,relayOrigin:c,searchCounter:0,width:10,waiting:!0,queue:[],sendId:0,recvId:0,verifySendToken:String(Math.random()),verifyRecvToken:null,originVerified:!1},".."!==n&&e(a,s,i(n)),t(n)}}catch(l){return gadgets.warn("Caught exception setting up RMR: "+l),!1}return!0},call:function(e,t,i){return n(e,i.s,t,i)}}}()),gadgets.rpctx=gadgets.rpctx||{},gadgets.rpctx.ifpc||(gadgets.rpctx.ifpc=function(){function e(e){for(var t=[],n=0,i=e.length;n<i;++n)t.push(encodeURIComponent(gadgets.json.stringify(e[n])));return t.join("&")}function t(e){for(var t,n=i.length-1;0<=n;--n){var r=i[n];try{if(r&&(r.recyclable||"complete"===r.readyState)){if(r.parentNode.removeChild(r),!window.ActiveXObject){r.recyclable=!1,t=r;break}i[n]=r=null,i.splice(n,1)}}catch(a){}}t||(t=document.createElement("iframe"),t.style.border=t.style.width=t.style.height="0px",t.style.visibility="hidden",t.style.position="absolute",t.onload=function(){this.recyclable=!0},i.push(t)),t.src=e,window.setTimeout(function(){document.body.appendChild(t)},0)}var n,i=[],r=0,a={};return{getCode:function(){return"ifpc"},isParentVerifiable:function(){return!0},init:function(e,t){return n=t,n("..",!0),!0},setup:function(e,t){return n(e,!0),!0},call:function(n,i,a){var o=gadgets.rpc.getRelayUrl(n);if(++r,!o)return gadgets.warn("No relay file assigned for IFPC"),!1;var s=null,c=[];if(a.l)s=[o,"#",e([i,r,1,0,e([i,a.s,"","",i].concat(a.a))])].join(""),c.push(s);else{s=[o,"#",n,"&",i,"@",r,"&"].join(""),n=encodeURIComponent(gadgets.json.stringify(a)),i=2e3-s.length,a=Math.ceil(n.length/i);for(var l,o=0;0<n.length;)l=n.substring(0,i),n=n.substring(i),c.push([s,a,"&",o,"&",l].join("")),o+=1}do t(c.shift());while(0<c.length);return!0},_receiveMessage:function(e,t){var n=e[1],i=parseInt(e[2],10),r=parseInt(e[3],10),o=e[e.length-1],s=1===i;if(1<i){a[n]||(a[n]=[]),a[n][r]=o;e:{for(i-=1;0<=i;--i)if("undefined"==typeof a[n][i]){i=!1;break e}i=!0}i&&(o=a[n].join(""),delete a[n],s=!0)}s&&t(gadgets.json.parse(decodeURIComponent(o)))}}}()),window.gadgets.rpc||(gadgets.rpc=function(){function e(e,t){if(!S[e]){var n=j;t||(n=k),S[e]=n;for(var i=I[e]||[],r=0;r<i.length;++r){var a=i[r];a.t=T[e],n.call(e,a.f,a)}I[e]=[]}}function t(){function e(){L=!0}H||("undefined"!=typeof window.addEventListener?window.addEventListener("unload",e,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onunload",e),H=!0)}function n(e,n,i,r,a){T[n]&&T[n]===i||(gadgets.error("Invalid auth token. "+T[n]+" vs "+i),x(n,U)),a.onunload=function(){R[n]&&!L&&(x(n,G),gadgets.rpc.removeReceiver(n))},t(),r=gadgets.json.parse(decodeURIComponent(r))}function i(t,n){if(t&&"string"==typeof t.s&&"string"==typeof t.f&&t.a instanceof Array&&("function"!=typeof arbitrate||arbitrate(t.s,t.f)))if(T[t.f]&&T[t.f]!==t.t&&(gadgets.error("Invalid auth token. "+T[t.f]+" vs "+t.t),x(t.f,U)),"__ack"===t.s)window.setTimeout(function(){e(t.f,!0)},0);else{if(t.c&&(t.callback=function(e){gadgets.rpc.call(t.f,"__cb",null,t.c,e)}),n){var i=r(n);t.origin=n;var a=t.r;a&&r(a)==i||(a=n),t[_]=a}i=(m[t.s]||m[""]).apply(t,t.a),t.c&&"undefined"!=typeof i&&gadgets.rpc.call(t.f,"__cb",null,t.c,i)}}function r(e){if(!e)return"";e=e.toLowerCase(),0==e.indexOf("//")&&(e=window.location.protocol+e),-1==e.indexOf("://")&&(e=window.location.protocol+"//"+e);var t=e.substring(e.indexOf("://")+3),n=t.indexOf("/");-1!=n&&(t=t.substring(0,n)),e=e.substring(0,e.indexOf("://"));var n="",i=t.indexOf(":");if(-1!=i){var r=t.substring(i+1),t=t.substring(0,i);("http"===e&&"80"!==r||"https"===e&&"443"!==r)&&(n=":"+r)}return e+"://"+t+n}function a(e){if("/"==e.charAt(0)){var t=e.indexOf("|"),n=0<t?e.substring(1,t):e.substring(1);return e=0<t?e.substring(t+1):null,{id:n,origin:e}}return null}function o(e){if("undefined"==typeof e||".."===e)return window.parent;var t=a(e);if(t){for(e=window;!e.frames[t.id]&&e!==window.top;)e=e.parent;return e.frames[t.id]}return e=String(e),(t=document.getElementById(e))&&t.contentWindow?t.contentWindow:(t=window.frames[e])&&!t.closed?t:null}function s(e,t){if(!0!==R[e]){"undefined"==typeof R[e]&&(R[e]=0);var n=o(e);".."!==e&&null==n||!0!==j.setup(e,t)?!0!==R[e]&&10>R[e]++?window.setTimeout(function(){s(e,t)},500):(S[e]=k,R[e]=!0):R[e]=!0}}function c(e,t){var n=o(e);if(!C[e]||C[e]!==F&&n.Function.prototype!==C[e].constructor.prototype){var i=l(e);if(r(i)!==r(window.location.href))return C[e]=F,!1;try{C[e]=n.gadgets.rpc.receiveSameDomain}catch(a){return C[e]=F,!1}}return!(!C[e]||C[e]===F)&&(C[e](t),!0)}function l(e){return(e=E[e])&&"/"===e.substring(0,1)&&(e="/"===e.substring(1,2)?document.location.protocol+e:document.location.protocol+"//"+document.location.host+e),e}function d(e,t,n){/http(s)?:\/\/.+/.test(t)||(0==t.indexOf("//")?t=window.location.protocol+t:"/"==t.charAt(0)?t=window.location.protocol+"//"+window.location.host+t:-1==t.indexOf("://")&&(t=window.location.protocol+"//"+t)),E[e]=t,"undefined"!=typeof n&&(v[e]=!!n)}function u(e,t){t=t||"",T[e]=String(t),s(e,t)}function p(e){e=(e.passReferrer||"").split(":",2),O=e[0]||"none",A=e[1]||"origin"}function g(t){"true"===String(t.useLegacyProtocol)&&(j=gadgets.rpctx.ifpc,j.init(i,e))}function f(e,t){function n(n){n=n?n.rpc:{},p(n);var i=n.parentRelayUrl||"",i=r(b.parent||t)+i;d("..",i,"true"===String(n.useLegacyProtocol)),g(n),u("..",e)}!b.parent&&t?n({}):gadgets.config.register("rpc",null,n)}function h(e,t,n){if(".."===e)f(n||b.rpctoken||b.ifpctok||"",t);else e:{var i=null;if("/"!=e.charAt(0)){if(!gadgets.util)break e;if(i=document.getElementById(e),!i)throw Error("Cannot set up gadgets.rpc receiver with ID: "+e+", element not found.")}i=i&&i.src,t=t||gadgets.rpc.getOrigin(i),d(e,t),t=gadgets.util.getUrlParameters(i),u(e,n||t.rpctoken)}}var _="referer",m={},E={},v={},T={},y=0,w={},R={},C={},b={},S={},I={},O=null,A=null,N=!!gadgets.util.getUrlParameters().parent&&window.top!==window.self,P=window.name,x=function(){},G=1,U=2,M=window.console,D=M&&M.log?function(e){M.log(e)}:function(){},k=function(){function e(e){return function(){D(e+": call ignored")}}return{getCode:function(){return"noop"},isParentVerifiable:function(){return!0},init:e("init"),setup:e("setup"),call:e("call")}}();gadgets.util&&(b=gadgets.util.getUrlParameters());var L=!1,H=!1,j="flash"==b.rpctx?gadgets.rpctx.flash:"rmr"==b.rpctx?gadgets.rpctx.rmr:"function"==typeof window.postMessage?gadgets.rpctx.wpm:"object"==typeof window.postMessage?gadgets.rpctx.wpm:window.ActiveXObject?gadgets.rpctx.flash?gadgets.rpctx.flash:gadgets.rpctx.nix:0<navigator.userAgent.indexOf("WebKit")?gadgets.rpctx.rmr:"Gecko"===navigator.product?gadgets.rpctx.frameElement:gadgets.rpctx.ifpc;m[""]=function(){D("Unknown RPC service: "+this.s)},m.__cb=function(e,t){var n=w[e];n&&(delete w[e],n.call(this,t))};var F={};return{config:function(e){"function"==typeof e.securityCallback&&(x=e.securityCallback),"function"==typeof e.arbitrator&&(arbitrate=e.arbitrator)},register:function(e,t){if("__cb"===e||"__ack"===e)throw Error("Cannot overwrite callback/ack service");if(""===e)throw Error("Cannot overwrite default service: use registerDefault");var n=m[e];return m[e]=t,n},unregister:function(e){if("__cb"===e||"__ack"===e)throw Error("Cannot delete callback/ack service");if(""===e)throw Error("Cannot delete default service: use unregisterDefault");delete m[e]},registerDefault:function(e){m[""]=e},unregisterDefault:function(){delete m[""]},forceParentVerifiable:function(){j.isParentVerifiable()||(j=gadgets.rpctx.ifpc)},call:function(e,t,n,i){e=e||"..";var r="..";".."===e?r=P:"/"==e.charAt(0)&&(r=gadgets.rpc.getOrigin(window.location.href),r="/"+P+(r?"|"+r:"")),++y,n&&(w[y]=n);var o,s={s:t,f:r,c:n?y:0,a:Array.prototype.slice.call(arguments,3),t:T[e],l:!!v[e]};e:if("bidir"===O||"c2p"===O&&".."===e||"p2c"===O&&".."!==e){o=window.location.href;var l="?";if("query"===A)l="#";else if("hash"===A)break e;l=o.lastIndexOf(l),l=-1===l?o.length:l,o=o.substring(0,l)}else o=null;o&&(s.r=o),".."!==e&&null==a(e)&&!document.getElementById(e)||c(e,s)||((o=S[e])||null===a(e)||(o=j),o?(v[e]&&(o=gadgets.rpctx.ifpc),!1===o.call(e,r,s)&&(S[e]=k,j.call(e,r,s))):I[e]?I[e].push(s):I[e]=[s])},getRelayUrl:l,setRelayUrl:d,setAuthToken:u,setupReceiver:h,getAuthToken:function(e){return T[e]},removeReceiver:function(e){delete E[e],delete v[e],delete T[e],delete R[e],delete C[e],delete S[e]},getRelayChannel:function(){return j.getCode()},receive:function(e,t){4<e.length?j._receiveMessage(e,i):n.apply(null,e.concat(t))},receiveSameDomain:function(e){e.a=Array.prototype.slice.call(e.a),window.setTimeout(function(){i(e)},0)},getOrigin:r,getTargetOrigin:function(e){var t=null,t=l(e);return t||(t=(t=a(e))?t.origin:".."==e?b.parent:document.getElementById(e).src),r(t)},init:function(){!1===j.init(i,e)&&(j=k),N?h(".."):gadgets.config.register("rpc",null,function(e){e=e.rpc||{},p(e),g(e)})},_getTargetWin:o,_parseSiblingId:a,ACK:"__ack",RPC_ID:P||"..",SEC_ERROR_LOAD_TIMEOUT:0,SEC_ERROR_FRAME_PHISH:G,SEC_ERROR_FORGED_MSG:U}}(),gadgets.rpc.init()),shindig.uri=function(){var e=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/;return function(t){function n(t){if(null===t.match(e))throw"Malformed URL: "+t;h=RegExp.$1,_=RegExp.$2,m=RegExp.$3,E=RegExp.$4,T=RegExp.$5}function i(e){for(var t=[],n=0,i=e.length;n<i;++n){var r=e[n][0],a=e[n][1];"undefined"!=typeof a&&t.push(R(r)+(null!==a?"="+R(a):""))}return t.join("&")}function r(){return v&&(E=i(v),v=null),E}function a(){
    return y&&(T=i(y),y=null),T}function o(e){return v=v||u(E),p(v,e)}function s(e){return y=y||u(T),p(y,e)}function c(e,t){return v=g(v||u(E),e,t),C}function l(e,t){return y=g(y||u(T),e,t),C}function d(){return[h,""!==h?":":"",""!==_?"//":"",_].join("")}function u(e){var t=[];if(""===e)return t;e=e.split("&");for(var n=0,i=e.length;n<i;++n){var r=e[n].split("="),a=r.shift(),o=null;0<r.length&&(o=r.join("").replace(/\+/g," ")),t.push([a,null!=o?w(o):null])}return t}function p(e,t){for(var n=0,i=e.length;n<i;++n)if(e[n][0]==t)return e[n][1]}function g(e,t,n){var i=t;"string"==typeof t&&(i={},i[t]=n);for(var r in i){t=!1,n=0;for(var a=e.length;!t&&n<a;++n)e[n][0]==r&&(e[n][1]=i[r],t=!0);t||e.push([r,i[r]])}return e}function f(e,t){return e=e||"",e[0]===t&&(e=e.substr(t.length)),e}var h="",_="",m="",E="",v=null,T="",y=null,w=window.decodeURIComponent?decodeURIComponent:unescape,R=window.encodeURIComponent?encodeURIComponent:escape,C=null;return"object"==typeof t&&"function"==typeof t.toString?n(t.toString()):t&&n(t),C={getSchema:function(){return h},getAuthority:function(){return _},getOrigin:d,getPath:function(){return m},getQuery:r,getFragment:a,getQP:o,getFP:s,setSchema:function(e){return h=e,C},setAuthority:function(e){return _=e,C},setPath:function(e){return"undefined"!=typeof e&&null!=e&&(m=("/"===e[0]?"":"/")+e),C},setQuery:function(e){return v=null,E=f(e,"?"),C},setFragment:function(e){return y=null,T=f(e,"#"),C},setQP:c,setFP:l,setExistingP:function(e,t){return"undefined"!=typeof o(e,t)&&c(e,t),"undefined"!=typeof s(e,t)&&l(e,t),C},toString:function(){var e=r(),t=a();return[d(),m,""!==e?"?":"",e,""!==t?"#":"",t].join("")}}}}(),gadgets.io=function(){function x(){var e;if("undefined"!=typeof shindig&&shindig.xhrwrapper&&shindig.xhrwrapper.createXHR)return shindig.xhrwrapper.createXHR();if("undefined"!=typeof ActiveXObject)try{return(e=new ActiveXObject("Msxml2.XMLHTTP"))||(e=new ActiveXObject("Microsoft.XMLHTTP")),e}catch(t){}if("undefined"!=typeof XMLHttpRequest||window.XMLHttpRequest)return new window.XMLHttpRequest;throw"no xhr available"}function v(e,t){if(4!==e.readyState)return!0;try{if(200!==e.status){var n=""+e.status;return e.responseText&&(n=n+" "+e.responseText),t({errors:[n],rc:e.status,text:e.responseText}),!0}}catch(i){return t({errors:[i.number+" Error not specified"],rc:i.number,text:i.description}),!0}return!1}function y(e,t,n,i){v(i,t)||t(r(n,{body:i.responseText}))}function s(c,d,a,b){if(!v(b,d)){b=b.responseText;var h=p.unparseableCruft,f=b.indexOf(h)+h.length;f<h.length||(b=b.substr(f),b=eval("("+b+")"),b=b[c],b.oauthState&&(q=b.oauthState),b.st&&shindig.auth.updateSecurityToken(b.st),d(r(a,b)))}}function r(e,t){var n={text:t.body,rc:t.rc||200,headers:t.headers,oauthApprovalUrl:t.oauthApprovalUrl,oauthError:t.oauthError,oauthErrorText:t.oauthErrorText,oauthErrorTrace:t.oauthErrorTrace,oauthErrorUri:t.oauthErrorUri,oauthErrorExplanation:t.oauthErrorExplanation,errors:[]};if(200>n.rc||400<=n.rc)n.errors=[n.rc+" Error"];else if(n.text)switch(300<=n.rc&&400>n.rc&&(e.CONTENT_TYPE="TEXT"),e.CONTENT_TYPE){case"JSON":case"FEED":n.data=gadgets.json.parse(n.text),n.data||(n.errors.push("500 Failed to parse JSON"),n.rc=500,n.data=null);break;case"DOM":var i;"undefined"!=typeof DOMParser?(i=(new DOMParser).parseFromString(n.text,"text/xml"),"parsererror"===i.documentElement.nodeName?(n.errors.push("500 Failed to parse XML"),n.rc=500):n.data=i):"undefined"!=typeof ActiveXObject?(i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.validateOnParse=!1,i.resolveExternals=!1,i.loadXML(n.text)?n.data=i:(n.errors.push("500 Failed to parse XML"),n.rc=500)):(n.errors.push("500 Failed to parse XML because no DOM parser was available"),n.rc=500);break;default:n.data=n.text}return n}function t(e,t,n,i,r,a,o,s){var c=x();0==t.indexOf("//")&&(t=document.location.protocol+t),c.open(r,t,!0),n&&(e=gadgets.util.makeClosure(null,o,e,n,a,c),gadgets.util.shouldPollXhrReadyStateChange()?z(c,e):c.onreadystatechange=e),"string"==typeof s&&(s={}),s=s||{},null!==i&&(s["Content-Type"]||(s["Content-Type"]="application/x-www-form-urlencoded"));for(var l in s)c.setRequestHeader(l,s[l]);c.send(i)}function z(e,t){var n=w;u[n]=window.setInterval(function(){e&&4===e.readyState&&(window.clearInterval(u[n]),delete u[n],t&&t())},p.xhrPollIntervalMs||50),w++}var w=0,u={},p={},q;return gadgets.config.register("core.io",null,function(e){p=e["core.io"]||{}}),{makeRequest:function(e,n,i){i=i||{};var a,o,c=i.METHOD||"GET",l=i.REFRESH_INTERVAL;i.AUTHORIZATION&&"NONE"!==i.AUTHORIZATION&&(a=i.AUTHORIZATION.toLowerCase(),o=shindig.auth.getSecurityToken());var d=!0;"undefined"!=typeof i.SIGN_OWNER&&(d=i.SIGN_OWNER);var u=!0;"undefined"!=typeof i.SIGN_VIEWER&&(u=i.SIGN_VIEWER);var g=i.HEADERS||{};"POST"!==c||g["Content-Type"]||(g["Content-Type"]="application/x-www-form-urlencoded");var f=gadgets.util.getUrlParameters(),d={url:e,httpMethod:c,headers:gadgets.io.encodeValues(g,!1),postData:i.POST_DATA||"",authz:a||"",st:o||"",contentType:i.CONTENT_TYPE||"TEXT",numEntries:i.NUM_ENTRIES||"3",getSummaries:!!i.GET_SUMMARIES,signOwner:d,signViewer:u,gadget:f.url,container:f.container||f.synd||"default",bypassSpecCache:gadgets.util.getUrlParameters().nocache||"",getFullHeaders:!!i.GET_FULL_HEADERS};if(i.hasOwnProperty("NO_CACHE")?d.nocache=i.NO_CACHE:f.hasOwnProperty("nocache")&&(d.nocache=f.nocache),"oauth"===a||"signed"===a||"oauth2"===a){gadgets.io.oauthReceivedCallbackUrl_&&(d.OAUTH_RECEIVED_CALLBACK=gadgets.io.oauthReceivedCallbackUrl_,gadgets.io.oauthReceivedCallbackUrl_=null),d.oauthState=q||"";for(var h in i)!i.hasOwnProperty(h)||0!==h.indexOf("OAUTH_")&&"code"!==h||(d[h]=i[h])}a=(o=o||shindig.auth.getSecurityToken())?{"X-Shindig-ST":o}:{},o=p.jsonProxyUrl.replace("%host%",document.location.host);e:{if(gadgets.io.preloaded_&&"GET"===d.httpMethod)for(h=0;h<gadgets.io.preloaded_.length;h++)if((f=gadgets.io.preloaded_[h])&&f.id===d.url){delete gadgets.io.preloaded_[h],200!==f.rc?n({rc:f.rc,errors:[f.rc+" Error"]}):(f.oauthState&&(q=f.oauthState),n(r(i,{body:f.body,rc:f.rc,headers:f.headers,oauthApprovalUrl:f.oauthApprovalUrl,oauthError:f.oauthError,oauthErrorText:f.oauthErrorText,oauthErrorTrace:f.oauthErrorTrace,oauthErrorUri:f.oauthErrorUri,oauthErrorExplanation:f.oauthErrorExplanation,errors:[]}))),h=!0;break e}h=!1}h||("GET"==c&&"undefined"!=typeof l&&(d.refresh=l),"GET"!==c||d.authz?(c=gadgets.io.encodeValues(d),t(e,o,n,c,"POST",i,s,a)):(c="?"+gadgets.io.encodeValues(d),t(e,o+c,n,null,"GET",i,s,a)))},makeNonProxiedRequest:function(e,n,i,r){i=i||{},t(e,e,n,i.POST_DATA,i.METHOD,i,y,r)},clearOAuthState:function(){q=void 0},encodeValues:function(e,t){var n,i=!t,r=[],a=!1;for(n in e)e.hasOwnProperty(n)&&!/___$/.test(n)&&(a?r.push("&"):a=!0,r.push(i?encodeURIComponent(n):n),r.push("="),r.push(i?encodeURIComponent(e[n]):e[n]));return r.join("")},getProxyUrl:function(e,t){var n=p.proxyUrl;if(!n)return n;var i=t||{},r=i.REFRESH_INTERVAL;"undefined"==typeof r&&(r="3600");var a=gadgets.util.getUrlParameters(),o=shindig.auth.getSecurityToken(),s=i[gadgets.io.RequestParameters.AUTHORIZATION],c=i[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME],i=i.rewriteMime?"&rewriteMime="+encodeURIComponent(i.rewriteMime):"",l="";return s&&(l=s==gadgets.io.AuthorizationType.OAUTH||s==gadgets.io.AuthorizationType.OAUTH2?"&authz="+s.toLowerCase()+"&st="+encodeURIComponent(o)+"&OAUTH_SERVICE_NAME="+encodeURIComponent(c):"&authz="+s.toLowerCase()),o=shindig.uri(e).getPath(),s="",c=o.lastIndexOf("/"),-1!==c&&(s=o.substring(c)),n=n.replace("%url%",encodeURIComponent(e)).replace("%host%",document.location.host).replace("%rawurl%",e).replace("%filename%",s).replace("%refresh%",encodeURIComponent(r)).replace("%gadget%",encodeURIComponent(a.url)).replace("%container%",encodeURIComponent(a.container||a.synd||"default")).replace("%authz%",l).replace("%rewriteMime%",i),0==n.indexOf("//")&&(n=window.location.protocol+n),n},processResponse_:s}}(),gadgets.io.RequestParameters=gadgets.util.makeEnum("ALIAS METHOD CONTENT_TYPE POST_DATA HEADERS AUTHORIZATION NUM_ENTRIES GET_SUMMARIES GET_FULL_HEADERS REFRESH_INTERVAL SIGN_OWNER SIGN_VIEWER OAUTH_SERVICE_NAME OAUTH_USE_TOKEN OAUTH_TOKEN_NAME OAUTH_REQUEST_TOKEN OAUTH_REQUEST_TOKEN_SECRET OAUTH_RECEIVED_CALLBACK NO_CACHE".split(" ")),gadgets.io.MethodType=gadgets.util.makeEnum(["GET","POST","PUT","DELETE","HEAD"]),gadgets.io.ContentType=gadgets.util.makeEnum(["TEXT","DOM","JSON","FEED"]),gadgets.io.AuthorizationType=gadgets.util.makeEnum(["NONE","SIGNED","OAUTH","OAUTH2"]),function(){osapi.newBatch=function(){var e={},t=[],n=function(e){var t={method:e.request.method,id:e.key};return e.request.rpc&&(t.params=e.request.rpc),t};return e.execute=function(e){for(var i={},r={},a=0,o=[],s=0;s<t.length;s++){var c=t[s].request.transport;r[c.name]||(o.push(c),a++),r[c.name]=r[c.name]||[],r[c.name].push(n(t[s]))}for(s=function(n){n.error&&(i.error=n.error);for(var r=0;r<t.length;r++){var o=t[r].key,s=n[o];s&&(i[o]=s.error?s:s.data||s.result)}a--,0===a&&e(i)},c=0;c<o.length;c++)o[c].execute(r[o[c].name],s);0==a&&window.setTimeout(function(){e(i)},0)},e.add=function(n,i){return i&&n&&t.push({key:n,request:i}),e},e}}(),osapi._registerMethod=function(e,t){if("newBatch"!==e){for(var n=e.split("."),i=osapi,r=0;r<n.length-1;r++)i[n[r]]=i[n[r]]||{},i=i[n[r]];var a,o=n[n.length-1];i[o]&&(a=i[o]),i[o]=function(n){return n=n||{},n.userId=n.userId||"@viewer",n.groupId=n.groupId||"@self",new osapi._BoundCall(e,t,n)},"undefined"!=typeof tamings___&&(n=function(){caja___.markFunction(i[o],e)},a&&a.__taming_index?(i[o].__taming_index=a.__taming_index,tamings___[a.__taming_index]=n):(i[o].__taming_index=tamings___.length,tamings___.push(n)))}},osapi._BoundCall=function(e,t,n){this.method=e,this.transport=t,this.rpc=n},osapi._BoundCall.prototype.execute=function(e){var t="undefined"!=typeof caja___&&caja___.getUseless&&caja___.getUseless(),n=t?caja___.getUseless():this,i=t?caja___.untame(e):e;e=osapi.newBatch(),e.add(this.method,this),e.execute(function(e){e.error?i.call(n,{error:e.error}):i.call(n,e[n.method])})},shindig._uri=shindig.uri,shindig.uri=function(){var e=shindig._uri;return shindig._uri=null,function(t){var n=e(t);return n.hasSameOrigin=function(e){return n.getOrigin()==e.getOrigin()},n.resolve=function(e){""==n.getSchema()&&n.setSchema(e.getSchema()),""==n.getAuthority()&&n.setAuthority(e.getAuthority());var t=n.getPath();if(""==t||"/"!=t.charAt(0)){var i=e.getPath(),r=i.lastIndexOf("/");-1!=r&&i.substring(0,r+1),n.setPath(e.getPath()+t)}},n}}(),function(){function e(e,t){var i={POST_DATA:gadgets.json.stringify(e),CONTENT_TYPE:"JSON",METHOD:"POST",AUTHORIZATION:"SIGNED"},r={"Content-Type":"application/json"},a=this.name,o=shindig.auth.getSecurityToken();o&&(n?r.Authorization="OAuth2 "+o:a=a+"?st="+encodeURIComponent(o)),gadgets.io.makeNonProxiedRequest(a,function(e){if(e.errors[0])t({error:{code:e.rc,message:e.text}});else if(e=e.result||e.data,e.error)t(e);else{for(var n={},i=0;i<e.length;i++)n[e[i].id]=e[i];t(n)}},i,r)}function t(t){var i=t["osapi.services"];if(n=t["osapi.useOAuth2"],i)for(var r in i)if(i.hasOwnProperty(r)&&(0==r.indexOf("http")||0==r.indexOf("//"))){t={name:r.replace("%host%",document.location.host),execute:e};for(var a=i[r],o=0;o<a.length;o++)osapi._registerMethod(a[o],t)}}var n;gadgets.config&&gadgets.config.register("osapi.services",null,t)}(),gadgets.util.registerOnLoadHandler(function(){osapi&&osapi.people&&osapi.people.get&&(osapi.people.getViewer=function(e){return e=e||{},e.userId="@viewer",e.groupId="@self",osapi.people.get(e)},osapi.people.getViewerFriends=function(e){return e=e||{},e.userId="@viewer",e.groupId="@friends",osapi.people.get(e)},osapi.people.getOwner=function(e){return e=e||{},e.userId="@owner",e.groupId="@self",osapi.people.get(e)},osapi.people.getOwnerFriends=function(e){return e=e||{},e.userId="@owner",e.groupId="@friends",osapi.people.get(e)})}),osapi.container={},osapi.container.MetadataParam={LOCAL_EXPIRE_TIME:"localExpireTimeMs",URL:"url"},osapi.container.MetadataResponse={IFRAME_URLS:"iframeUrls",NEEDS_TOKEN_REFRESH:"needsTokenRefresh",VIEWS:"views",EXPIRE_TIME_MS:"expireTimeMs",FEATURES:"features",HEIGHT:"height",MODULE_PREFS:"modulePrefs",PREFERRED_HEIGHT:"preferredHeight",PREFERRED_WIDTH:"preferredWidth",RESPONSE_TIME_MS:"responseTimeMs",WIDTH:"width",TOKEN_TTL:"tokenTTL"},osapi.container.TokenResponse={TOKEN:"token",TOKEN_TTL:"tokenTTL",MODULE_ID:"moduleId"},osapi.container.NavigateTiming={URL:"url",ID:"id",START:"start",XRT:"xrt",SRT:"srt",DL:"dl",OL:"ol",PRT:"prt"},osapi.container.RenderParam={ALLOW_DEFAULT_VIEW:"allowDefaultView",CAJOLE:"cajole",CLASS:"class",DEBUG:"debug",HEIGHT:"height",NO_CACHE:"nocache",TEST_MODE:"testmode",USER_PREFS:"userPrefs",VIEW:"view",WIDTH:"width",MODULE_ID:"moduleid",SCROLL:"scroll"},osapi.container.ViewParam={VIEW:"view"},osapi.container.CallbackType={ON_BEFORE_PRELOAD:"onBeforePreload",ON_PRELOADED:"onPreloaded",ON_BEFORE_NAVIGATE:"onBeforeNavigate",ON_NAVIGATED:"onNavigated",ON_BEFORE_CLOSE:"onBeforeClose",ON_CLOSED:"onClosed",ON_BEFORE_UNLOAD:"onBeforeUnload",ON_UNLOADED:"onUnloaded",ON_BEFORE_RENDER:"onBeforeRender",ON_RENDER:"onRender",GADGET_ON_LOAD:"__gadgetOnLoad"},osapi.container.ContainerConfig={ALLOW_DEFAULT_VIEW:"allowDefaultView",RENDER_CAJOLE:"renderCajole",RENDER_DEBUG:"renderDebug",RENDER_DEBUG_PARAM:"renderDebugParam",RENDER_TEST:"renderTest",TOKEN_REFRESH_INTERVAL:"tokenRefreshInterval",NAVIGATE_CALLBACK:"navigateCallback",PRELOAD_REF_TIME:"preloadRefTime",PRELOAD_METADATAS:"preloadMetadatas",PRELOAD_TOKENS:"preloadTokens",GET_LANGUAGE:"GET_LANGUAGE",GET_COUNTRY:"GET_COUNTRY",GET_PREFERENCES:"GET_PREFERENCES",SET_PREFERENCES:"SET_PREFERENCES",RPC_ARBITRATOR:"rpcArbitrator",GET_GADGET_TOKEN:"GET_GADGET_TOKEN",GET_CONTAINER_TOKEN:"GET_CONTAINER_TOKEN"},osapi.container.ServiceConfig={API_HOST:"apiHost",API_PATH:"apiPath"},osapi.container.util={},osapi.container.util.getSafeJsonValue=function(e,t,n){return"undefined"!=typeof e[t]&&null!=e[t]?e[t]:n},osapi.container.util.mergeJsons=function(e,t){var n,i={};for(n in e)i[n]=e[n];for(n in t)i[n]=t[n];return i},osapi.container.util.newMetadataRequest=function(e){return osapi.container.util.isArray(e)||(e=[e]),{container:window.__CONTAINER,ids:e,fields:"iframeUrls modulePrefs.* needsTokenRefresh userPrefs.* views.preferredHeight views.preferredWidth expireTimeMs responseTimeMs rpcServiceIds tokenTTL".split(" ")}},osapi.container.util.newTokenRequest=function(e){return osapi.container.util.isArray(e)||(e=[e]),{container:window.__CONTAINER,ids:e,fields:["token","tokenTTL","moduleId"]}},osapi.container.util.toArrayOfJsonKeys=function(e){var t,n=[];for(t in e)n.push(t);return n},osapi.container.util.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},osapi.container.util.isEmptyJson=function(e){for(var t in e)return!1;return!0},osapi.container.util.getCurrentTimeMs=function(){return(new Date).getTime()},osapi.container.util.createIframeHtml=function(e){var t=[],n=0;t[n++]="<iframe ";for(var i in e){var r=e[i];"undefined"!=typeof r&&(t[n++]=i,t[n++]='="',t[n++]=r,t[n++]='" ')}return t[n++]="></iframe>",t.join("")},osapi.container.util.buildTokenRequestUrl=function(e,t){return e=shindig.uri(e),t&&e.setFP("moduleId",t),e.toString()},osapi.container.Site=function(e,t,n,i){this.container_=e,this.service_=t,this.id_=(this.el_=n)&&this.el_.id?this.el_.id:osapi.container.Site.prototype.nextUniqueSiteId_++,this.title_=this.ownerId_=this.parentId_=void 0},osapi.container.Site.DEFAULT_TITLE="default title",osapi.container.Site.prototype.nextUniqueSiteId_=0,osapi.container.Site.prototype.onConstructed=function(){},osapi.container.Site.prototype.getId=function(){return this.id_},osapi.container.Site.prototype.setWidth=function(e){var t=this.getActiveSiteHolder();return t&&(t=t.getIframeElement())&&(t.style.width=e+"px"),this},osapi.container.Site.prototype.setHeight=function(e){var t=this.getActiveSiteHolder();return t&&(t=t.getIframeElement())&&(t.style.height=e+"px"),this},osapi.container.Site.prototype.setTitle=function(e){this.title_=e;var t=this.getActiveSiteHolder();return t&&t.setTitle(e),this},osapi.container.Site.prototype.getTitle=function(){if("undefined"!=typeof this.title_)return this.title_;var e=this.getActiveSiteHolder();return e&&e.gadgetInfo_&&(e=e.gadgetInfo_)&&e.modulePrefs&&e.modulePrefs.title?e.modulePrefs.title:osapi.container.Site.DEFAULT_TITLE},osapi.container.Site.prototype.close=function(){var e=this.getActiveSiteHolder();e&&e.dispose()},osapi.container.Site.prototype.getParentId=function(){return this.parentId_},osapi.container.Site.prototype.setParentId=function(e){return this.parentId_=e,this},osapi.container.Site.prototype.getActiveSiteHolder=function(){throw Error("This method must be implemented by a subclass.")},osapi.container.Site.prototype.render=function(){throw Error("This method must be implemented by a subclass.")},osapi.container.SiteHolder=function(e,t,n){this.site_=e,this.el_=t,this.onLoad_=n,this.renderParams_=this.iframeId_=void 0,this.onConstructed()},osapi.container.SiteHolder.prototype.onConstructed=function(){},osapi.container.SiteHolder.prototype.getElement=function(){return this.el_},osapi.container.SiteHolder.prototype.getIframeId=function(){return this.iframeId_},osapi.container.SiteHolder.prototype.dispose=function(){this.el_&&this.el_.firstChild&&this.el_.removeChild(this.el_.firstChild)},osapi.container.SiteHolder.prototype.createIframeHtml=function(e,t){var n=this.createIframeAttributeMap(e,t);return n.onload=this.onLoad_?"window."+this.onLoad_+"('"+this.getUrl()+"', '"+this.site_.getId()+"');":void 0,osapi.container.util.createIframeHtml(n)},osapi.container.SiteHolder.prototype.createIframeAttributeMap=function(e,t){var n=this.renderParams_||{},n={id:this.iframeId_,name:this.iframeId_,src:e,scrolling:n[osapi.container.RenderParam.SCROLL]?"yes":"no",marginwidth:0,marginheight:0,frameborder:0,vspace:0,hspace:0,"class":n[osapi.container.RenderParam.CLASS],height:n[osapi.container.RenderParam.HEIGHT],width:n[osapi.container.RenderParam.WIDTH]};if(t)for(var i in t)n[i]=t[i];return n},osapi.container.SiteHolder.prototype.setTitle=function(e){var t=this.getIframeElement();t&&(t.title=e)},osapi.container.SiteHolder.prototype.getIframeElement=function(){throw Error("This method must be implemented by a subclass.")},osapi.container.SiteHolder.prototype.render=function(){throw Error("This method must be implemented by a subclass.")},osapi.container.SiteHolder.prototype.getUrl=function(){throw Error("This method must be implemented by a subclass.")},osapi.container.GadgetHolder=function(e,t,n){osapi.container.SiteHolder.call(this,e,t,n),this.securityToken_=this.viewParams_=this.gadgetInfo_=void 0,this.isOaaIframe_=!1,this.onConstructed()},osapi.container.GadgetHolder.prototype=new osapi.container.SiteHolder,osapi.container.GadgetHolder.prototype.relayPath_=null,osapi.container.GadgetHolder.prototype.getGadgetInfo=function(){return this.gadgetInfo_},osapi.container.GadgetHolder.prototype.dispose=function(){this.isOaaIframe_&&this.removeOaaContainer_(this.iframeId_),osapi.container.SiteHolder.prototype.dispose.call(this),this.gadgetInfo_=null},osapi.container.GadgetHolder.prototype.getUrl=function(){return this.gadgetInfo_&&this.gadgetInfo_.url},osapi.container.GadgetHolder.prototype.getView=function(){return this.renderParams_[osapi.container.RenderParam.VIEW]},osapi.container.GadgetHolder.prototype.getIframeElement=function(){return this.el_.getElementsByTagName("iframe")[0]},osapi.container.GadgetHolder.prototype.setSecurityToken=function(e){return this.securityToken_=e,this},osapi.container.GadgetHolder.prototype.render=function(e,t,n){this.iframeId_=osapi.container.GadgetHolder.IFRAME_ID_PREFIX_+this.site_.getId(),this.gadgetInfo_=e,this.viewParams_=t,this.renderParams_=n,(this.isOaaIframe_=this.hasFeature_(e,"pubsub-2"))?this.doOaaIframeHtml_():this.doNormalIframeHtml_()},osapi.container.GadgetHolder.IFRAME_ID_PREFIX_="__gadget_",osapi.container.GadgetHolder.prototype.doNormalIframeHtml_=function(){var e=this.getIframeUrl_();this.el_.innerHTML=this.createIframeHtml(e,{title:this.site_.getTitle()});var e=shindig.uri(e),t=shindig.uri().setSchema(e.getSchema()).setAuthority(e.getAuthority()).setPath(this.relayPath_);gadgets.rpc.setupReceiver(this.iframeId_,t.toString(),e.getFP("rpctoken"))},osapi.container.GadgetHolder.prototype.doOaaIframeHtml_=function(){this.removeOaaContainer_(this.iframeId_);var e=this;new OpenAjax.hub.IframeContainer(gadgets.pubsub2router.hub,this.iframeId_,{Container:{onSecurityAlert:function(e,t){gadgets.error(["Security error for container ",e.getClientID()," : ",t].join("")),e.getIframe().src="about:blank"},onConnect:function(e){gadgets.log(["connected: ",e.getClientID()].join(""))}},IframeContainer:{parent:this.el_,uri:this.getIframeUrl_(),tunnelURI:shindig.uri(this.relayPath_).resolve(shindig.uri(window.location.href)),iframeAttrs:this.createIframeAttributeMap(this.getIframeUrl_(),{title:this.site_.getTitle()}),onGadgetLoad:function(){e.onLoad_&&window[e.onLoad_](e.getUrl(),e.site_.getId())}}})},osapi.container.GadgetHolder.prototype.removeOaaContainer_=function(e){(e=gadgets.pubsub2router.hub.getContainer(e))&&gadgets.pubsub2router.hub.removeContainer(e)},osapi.container.GadgetHolder.prototype.hasFeature_=function(e,t){var n=e[osapi.container.MetadataResponse.MODULE_PREFS];return!!(n&&(n=n[osapi.container.MetadataResponse.FEATURES])&&n[t])},osapi.container.GadgetHolder.prototype.getIframeUrl_=function(){var e=shindig.uri(this.gadgetInfo_[osapi.container.MetadataResponse.IFRAME_URLS][this.getView()]);if(e.setQP("debug",this.renderParams_[osapi.container.RenderParam.DEBUG]?"1":"0"),e.setQP("nocache",this.renderParams_[osapi.container.RenderParam.NO_CACHE]?"1":"0"),e.setQP("testmode",this.renderParams_[osapi.container.RenderParam.TEST_MODE]?"1":"0"),e.setQP("view",this.getView()),this.renderParams_[osapi.container.RenderParam.CAJOLE]){var t=e.getQP("libs");null==t||""==t?e.setQP("libs","caja"):e.setQP("libs",[t,":caja"].join("")),e.setQP("caja","1")}this.updateUserPrefParams_(e),e.setQP("parent",window.__CONTAINER_URI.getOrigin()),this.securityToken_&&e.setExistingP("st",this.securityToken_),e.setQP("mid",String(this.site_.getModuleId())),osapi.container.util.isEmptyJson(this.viewParams_)||(t=gadgets.json.stringify(this.viewParams_),e.setFP("view-params",t)),"undefined"==typeof e.getFP("rpctoken")&&(t=2147483647*Math.random()|0,e.setFP("rpctoken",t));var t=this.site_.service_.getLanguage(),n=this.site_.service_.getCountry(),i=e.getQP("lang"),r=e.getQP("country");return-1!=i.indexOf("%")&&e.setQP("lang",t),-1!=r.indexOf("%")&&e.setQP("country",n),e.toString()},osapi.container.GadgetHolder.prototype.updateUserPrefParams_=function(e){var t=this.renderParams_[osapi.container.RenderParam.USER_PREFS];if(t)for(var n in t){var i="up_"+n,r=t[n];r instanceof Array&&(r=r.join("|")),e.setExistingP(i,r)}},gadgets.config&&gadgets.config.register("container",null,function(e){e.container&&(osapi.container.GadgetHolder.prototype.relayPath_=e.container.relayPath)}),osapi.container.GadgetSite=function(e,t,n){osapi.container.Site.call(this,e,t,n.gadgetEl),this.navigateCallback_=n.navigateCallback,this.loadingGadgetEl_=n.bufferEl,this.gadgetOnLoad_=n.gadgetOnLoad,this.moduleId_=0,this.loadingGadgetHolder_=this.currentGadgetHolder_=void 0,this.onConstructed()},osapi.container.GadgetSite.prototype=new osapi.container.Site,osapi.container.GadgetSite.prototype.getModuleId=function(){return this.moduleId_},osapi.container.GadgetSite.prototype.setModuleId_=function(e,t,n){if(t&&this.moduleId_!=t){var i=this;if(e=osapi.container.util.buildTokenRequestUrl(e,t),!i.service_.getCachedGadgetToken(e))return t=osapi.container.util.newTokenRequest([e]),void i.service_.getGadgetToken(t,function(t){var r;t&&t[e]&&((r=t[e][osapi.container.TokenResponse.TOKEN_TTL])&&i.container_.scheduleRefreshTokens_(r),(t=t[e][osapi.container.TokenResponse.MODULE_ID])||0==t)&&(i.moduleId_=t),n&&n()})}n&&n()},osapi.container.GadgetSite.prototype.getActiveSiteHolder=function(){return this.loadingGadgetHolder_||this.currentGadgetHolder_},osapi.container.GadgetSite.prototype.setTitle=function(e){return osapi.container.Site.prototype.setTitle.call(this,e),this.loadingGadgetHolder_&&this.currentGadgetHolder_&&this.currentGadgetHolder_.setTitle(e),this},osapi.container.GadgetSite.prototype.getFeature=function(e,t){var n=t||this.getActiveSiteHolder().getGadgetInfo();return n[osapi.container.MetadataResponse.FEATURES]&&n[osapi.container.MetadataResponse.FEATURES][e]},osapi.container.GadgetSite.prototype.navigateTo=function(e,t,n,i){var r=osapi.container.util.getCurrentTimeMs(),a=this.service_.getCachedGadgetMetadata(e),o=i||function(){};i=osapi.container.util.newMetadataRequest([e]);var s=this;this.service_.getGadgetMetadata(i,function(i){var c=a?0:osapi.container.util.getCurrentTimeMs()-r,l=i[e];l.error?(i=["Failed to navigate for gadget ",e,"."].join(""),gadgets.warn(i),i=["Detailed error: ",l.error.code||""," ",l.error.message||""].join(""),gadgets.log(i)):s.setModuleId_(e,n[osapi.container.RenderParam.MODULE_ID]||0,function(){s.container_.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_RENDER,l),s.render(l,t,n)}),i={},i[osapi.container.NavigateTiming.URL]=e,i[osapi.container.NavigateTiming.ID]=s.id_,i[osapi.container.NavigateTiming.START]=r,i[osapi.container.NavigateTiming.XRT]=c,s.onNavigateTo(i),o(l)})},osapi.container.GadgetSite.prototype.onNavigateTo=function(e){if(this.navigateCallback_){var t=window[this.navigateCallback_];"function"==typeof t&&t(e)}},osapi.container.GadgetSite.prototype.render=function(e,t,n){var i=null;(this.currentGadgetHolder_?this.currentGadgetHolder_.getUrl():null)==e.url&&(i=this.currentGadgetHolder_.getView());var r=function(t){if("undefined"!=typeof t&&null!=t){t=t.aliases||[];for(var n=0;n<t.length;n++)if(e[osapi.container.MetadataResponse.VIEWS][t[n]])return{view:t[n],viewInfo:e[osapi.container.MetadataResponse.VIEWS][t[n]]}}return null},i=n[osapi.container.RenderParam.VIEW]||t[osapi.container.ViewParam.VIEW]||i,a=e[osapi.container.MetadataResponse.VIEWS][i];if(i&&!a){var o=r(gadgets.config.get("views")[i]);o&&(i=o.view,a=o.viewInfo)}if(!a&&n[osapi.container.RenderParam.ALLOW_DEFAULT_VIEW]&&i!=osapi.container.GadgetSite.DEFAULT_VIEW_&&(i=osapi.container.GadgetSite.DEFAULT_VIEW_,a=e[osapi.container.MetadataResponse.VIEWS][i],!a&&(o=r(gadgets.config.get("views")[i])))&&(i=o.view,a=o.viewInfo),a){this.currentGadgetHolder_&&!this.loadingGadgetEl_?(this.loadingGadgetHolder_=this.currentGadgetHolder_,this.currentGadgetHolder_=null):this.loadingGadgetHolder_=new osapi.container.GadgetHolder(this,this.loadingGadgetEl_||this.el_,this.gadgetOnLoad_);var s,r={};for(s in n)r[s]=n[s];r[osapi.container.RenderParam.VIEW]=i,r[osapi.container.RenderParam.HEIGHT]=n[osapi.container.RenderParam.HEIGHT]||a[osapi.container.MetadataResponse.PREFERRED_HEIGHT]||e[osapi.container.MetadataResponse.MODULE_PREFS][osapi.container.MetadataResponse.HEIGHT]||String(osapi.container.GadgetSite.DEFAULT_HEIGHT_),r[osapi.container.RenderParam.WIDTH]=n[osapi.container.RenderParam.WIDTH]||a[osapi.container.MetadataResponse.PREFERRED_WIDTH]||e[osapi.container.MetadataResponse.MODULE_PREFS][osapi.container.MetadataResponse.WIDTH]||String(osapi.container.GadgetSite.DEFAULT_WIDTH_),this.updateSecurityToken_(e,r),this.loadingGadgetHolder_.render(e,t,r)}else gadgets.warn(["Unsupported view ",i," for gadget ",e.url,"."].join(""))},osapi.container.GadgetSite.prototype.onRender=function(){this.swapBuffers_(),this.loadingGadgetHolder_&&(this.currentGadgetHolder_&&this.currentGadgetHolder_.dispose(),this.currentGadgetHolder_=this.loadingGadgetHolder_,this.loadingGadgetHolder_=null)},osapi.container.GadgetSite.prototype.rpcCall=function(e,t,n){this.currentGadgetHolder_&&gadgets.rpc.call(this.currentGadgetHolder_.getIframeId(),e,t,n)},osapi.container.GadgetSite.prototype.updateSecurityToken_=function(e,t){var n=osapi.container.util.buildTokenRequestUrl(e.url,this.moduleId_);(n=this.service_.getCachedGadgetToken(n))&&this.loadingGadgetHolder_.setSecurityToken(n[osapi.container.TokenResponse.TOKEN])},osapi.container.GadgetSite.prototype.close=function(){this.loadingGadgetHolder_&&this.loadingGadgetHolder_.dispose(),this.currentGadgetHolder_&&this.currentGadgetHolder_.dispose()},osapi.container.GadgetSite.prototype.swapBuffers_=function(){if(this.loadingGadgetEl_){this.loadingGadgetEl_.style.left="",this.loadingGadgetEl_.style.position="",this.el_.style.position="absolute",this.el_.style.left="-2000px";var e=this.el_;this.el_=this.loadingGadgetEl_,this.loadingGadgetEl_=e}},osapi.container.GadgetSite.RPC_ARG_KEY="gs",osapi.container.GadgetSite.DEFAULT_HEIGHT_=200,osapi.container.GadgetSite.DEFAULT_WIDTH_=320,osapi.container.GadgetSite.DEFAULT_VIEW_="default",osapi.container.UrlHolder=function(e,t,n){osapi.container.SiteHolder.call(this,e,t,n),this.url_=void 0,this.onConstructed()},osapi.container.UrlHolder.prototype=new osapi.container.SiteHolder,osapi.container.UrlHolder.prototype.dispose=function(){osapi.container.SiteHolder.prototype.dispose.call(this),this.url_=null},osapi.container.UrlHolder.prototype.getIframeElement=function(){return this.el_.firstChild},osapi.container.UrlHolder.prototype.getUrl=function(){return this.url_},osapi.container.UrlHolder.prototype.render=function(e,t){this.iframeId_=osapi.container.UrlHolder.IFRAME_PREFIX_+this.site_.getId(),this.renderParams_=t,this.el_.innerHTML=this.createIframeHtml(this.url_=e,{scrolling:"auto",title:this.site_.getTitle()})},osapi.container.UrlHolder.IFRAME_PREFIX_="__url_",osapi.container.UrlSite=function(e,t,n){osapi.container.Site.call(this,e,t,n[osapi.container.UrlSite.URL_ELEMENT]),this.url_=this.holder_=void 0,this.onConstructed()},osapi.container.UrlSite.prototype=new osapi.container.Site,osapi.container.UrlSite.prototype.getActiveSiteHolder=function(){return this.holder_},osapi.container.UrlSite.prototype.render=function(e,t){this.holder_=new osapi.container.UrlHolder(this,this.el_);var n,i={};for(n in t)i[n]=t[n];this.holder_.render(e,i)},osapi.container.UrlSite.URL_ELEMENT="urlEl",osapi.container.Service=function(e){this.container_=e,e=this.config_=e.config_||{};var t=((gadgets.config.get("osapi")||{}).endPoints||[window.__API_URI.getOrigin()+"/rpc"])[0],t=/^([^\/]*\/\/[^\/]+)(.*)$/.exec(t);this.apiHost_=String(osapi.container.util.getSafeJsonValue(e,osapi.container.ServiceConfig.API_HOST,t[1])),this.apiPath_=String(osapi.container.util.getSafeJsonValue(e,osapi.container.ServiceConfig.API_PATH,t[2])),this.cachedMetadatas_={},this.cachedTokens_={},e.GET_LANGUAGE&&(this.getLanguage=e.GET_LANGUAGE),e.GET_COUNTRY&&(this.getCountry=e.GET_COUNTRY),this.registerOsapiServices(),this.onConstructed(e)},osapi.container.Service.prototype.onConstructed=function(e){},osapi.container.Service.prototype.getGadgetMetadata=function(e,t){var n=t||function(){},i=osapi.container.util.toArrayOfJsonKeys(this.getUncachedDataByRequest_(this.cachedMetadatas_,e)),r=this.getCachedDataByRequest_(this.cachedMetadatas_,e);if(0==i.length)n(r);else{var a=this;e.ids=i,e.language=this.getLanguage(),e.country=this.getCountry(),this.updateContainerSecurityToken(function(t){if(t){for(var i=0;i<e.ids.length;i++)r[e.ids[i]]={error:t};n(r)}else osapi.gadgets.metadata(e).execute(function(t){if(t.error)for(var i=0;i<e.ids.length;i++){var o=e.ids[i];r[o]={error:t.error}}else for(o in i=osapi.container.util.getCurrentTimeMs(),t){var s=t[o];a.updateResponse_(s,o,i),a.cachedMetadatas_[o]=s,r[o]=s}n(r)})})}},osapi.container.Service.prototype.addGadgetMetadatas=function(e,t){this.addToCache_(e,t,this.cachedMetadatas_)},osapi.container.Service.prototype.addGadgetTokens=function(e,t){this.addToCache_(e,t,this.cachedTokens_)},osapi.container.Service.prototype.addToCache_=function(e,t,n){var i,r=osapi.container.util.getCurrentTimeMs();for(i in e){var a=e[i];this.updateResponse_(a,i,r,t),n[i]=a}},osapi.container.Service.prototype.updateResponse_=function(e,t,n,i){
    e[osapi.container.MetadataParam.URL]=t,e[osapi.container.MetadataParam.LOCAL_EXPIRE_TIME]=e[osapi.container.MetadataResponse.EXPIRE_TIME_MS]-(null==i?e[osapi.container.MetadataResponse.RESPONSE_TIME_MS]:i)+n},osapi.container.Service.prototype.getGadgetToken=function(e,t){var n=t||function(){},i=this,r=function(t){var r={};if(t.error)for(var a=0;a<e.ids.length;a++)r[e.ids[a]]={error:t.error};else for(a in t){var o=osapi.container.util.buildTokenRequestUrl(a,t[a][osapi.container.TokenResponse.MODULE_ID]);i.cachedTokens_[o]=t[a],r[a]=t[a]}n(r)};i.updateContainerSecurityToken(function(t){t?r({error:t}):i.config_[osapi.container.ContainerConfig.GET_GADGET_TOKEN]?i.config_[osapi.container.ContainerConfig.GET_GADGET_TOKEN](e,r):osapi.gadgets.token(e).execute(r)})},osapi.container.Service.prototype.getCachedGadgetMetadata=function(e){return this.cachedMetadatas_[e]},osapi.container.Service.prototype.getCachedGadgetToken=function(e){return this.cachedTokens_[e]},osapi.container.Service.prototype.uncacheStaleGadgetMetadataExcept=function(e){for(var t in this.cachedMetadatas_)"undefined"==typeof e[t]&&this.cachedMetadatas_[t][osapi.container.MetadataParam.LOCAL_EXPIRE_TIME]<osapi.container.util.getCurrentTimeMs()&&delete this.cachedMetadatas_[t]},osapi.container.Service.prototype.registerOsapiServices=function(){var e=this.apiHost_+this.apiPath_,t={"gadgets.rpc":["container.listMethods"]};t[e]=["gadgets.metadata","gadgets.token"],gadgets.config.init({osapi:{endPoints:[e]},"osapi.services":t})},osapi.container.Service.prototype.getCachedDataByRequest_=function(e,t){return this.filterCachedDataByRequest_(e,t,function(e){return"undefined"!=typeof e})},osapi.container.Service.prototype.getUncachedDataByRequest_=function(e,t){return this.filterCachedDataByRequest_(e,t,function(e){return"undefined"==typeof e})},osapi.container.Service.prototype.filterCachedDataByRequest_=function(e,t,n){for(var i={},r=0;r<t.ids.length;r++){var a=t.ids[r],o=e[a];n(o)&&(i[a]=o)}return i},osapi.container.Service.prototype.getLocale_=function(){var e=window.navigator;return e.userLanguage||e.systemLanguage||e.language},osapi.container.Service.prototype.getLanguage=function(){try{return this.getLocale_().split("-")[0]||"ALL"}catch(e){return"ALL"}},osapi.container.Service.prototype.getCountry=function(){try{return this.getLocale_().split("-")[1]||"ALL"}catch(e){return"ALL"}},function(){function e(e,t){for(;e.length;)e.shift().call(null,t)}function t(s){var c=this;n&&(clearTimeout(n),n=0),(s=s||this.config_[osapi.container.ContainerConfig.GET_CONTAINER_TOKEN])?r||(r=!0,s(function(s,l,d){r=!1,(a="number"==typeof l?800*l:a)&&(n=setTimeout(gadgets.util.makeClosure(c,t,null),a)),s?(shindig.auth.updateSecurityToken(s),i=osapi.container.util.getCurrentTimeMs(),e(o)):d&&e(o,d)})):(r=!1,e(o))}var n,i,r,a=144e4,o=[];osapi.container.Service.prototype.updateContainerSecurityToken=function(e,n,s){var c=osapi.container.util.getCurrentTimeMs(),l="boolean"!=typeof n&&n||void 0;n="boolean"==typeof n&&n,a&&(r||l||!i||c>i+a)?(!i||c>i+95*a/80||!e?e&&o.push(e):e(),l?t.call(this,function(e){e(l,s)}):r||n||t.call(this)):e&&e()}}(),osapi.container.Container=function(e){e=this.config_=e||{},this.gadgetLifecycleCallbacks_={},this.preloadedGadgetUrls_={},this.sites_={},this.allowDefaultView_=Boolean(osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.ALLOW_DEFAULT_VIEW,!0)),this.renderCajole_=Boolean(osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.RENDER_CAJOLE,!1)),this.renderDebugParam_=String(osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.RENDER_DEBUG_PARAM,osapi.container.ContainerConfig.RENDER_DEBUG));var t=window.__CONTAINER_URI.getQP(this.renderDebugParam_);this.renderDebug_="undefined"==typeof t?Boolean(osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.RENDER_DEBUG,!1)):"1"===t,this.renderTest_=Boolean(osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.RENDER_TEST,!1)),this.tokenRefreshInterval_=Number(osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.TOKEN_REFRESH_INTERVAL,0)),this.lastRefresh_=0,this.navigateCallback_=String(osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.NAVIGATE_CALLBACK,null)),this.service_=new osapi.container.Service(this),this.tokenRefreshTimer_=null;var n=this,i={};window[osapi.container.CallbackType.GADGET_ON_LOAD]=function(e,t){i.hasOwnProperty(t)||(n.getSiteById(t).onRender(),n.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_RENDER,e,t),i[t]=!0)},this.initializeMixins_(),this.setupRpcArbitrator_(e),this.preloadCaches(e),this.registerRpcServices_(),this.onConstructed(e)},osapi.container.Container.prototype.newGadgetSite=function(e,t){var n=new osapi.container.GadgetSite(this,this.service_,{navigateCallback:this.navigateCallback_,gadgetEl:e,bufferEl:t||null,gadgetOnLoad:osapi.container.CallbackType.GADGET_ON_LOAD});return this.sites_[n.getId()]=n},osapi.container.Container.prototype.navigateGadget=function(e,t,n,i,r){var a=r||function(){};r=osapi.container.ContainerConfig;var o=osapi.container.RenderParam;this.allowDefaultView_&&(i[o.ALLOW_DEFAULT_VIEW]=!0),this.renderCajole_&&(i[o.CAJOLE]=!0),this.renderDebug_&&(i[o.NO_CACHE]=!0,i[o.DEBUG]=!0),this.renderTest_&&(i[o.TEST_MODE]=!0),this.refreshService_();var s=this,c=function(r){i[o.USER_PREFS]=r,s.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_NAVIGATE,t,e.getId()),e.navigateTo(t,n,i,function(n){n.error?gadgets.warn(["Failed to possibly schedule token refresh for gadget ",t,"."].join("")):n[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]&&s.scheduleRefreshTokens_(n[osapi.container.MetadataResponse.TOKEN_TTL]),s.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_NAVIGATED,e),a(n)})};this.config_[r.GET_PREFERENCES]&&!i[o.USER_PREFS]?this.config_[r.GET_PREFERENCES](e.getId(),t,c):c(i[o.USER_PREFS])},osapi.container.Container.prototype.closeGadget=function(e){var t=e.getId();this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_CLOSE,e),e.close(),this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_CLOSED,e),delete this.sites_[t],e instanceof osapi.container.GadgetSite&&this.unscheduleRefreshTokens_()},osapi.container.Container.prototype.addGadgetLifecycleCallback=function(e,t){return!this.gadgetLifecycleCallbacks_[e]&&(this.gadgetLifecycleCallbacks_[e]=t,!0)},osapi.container.Container.prototype.removeGadgetLifecycleCallback=function(e){delete this.gadgetLifecycleCallbacks_[e]},osapi.container.Container.prototype.preloadGadget=function(e,t){this.preloadGadgets([e],t)},osapi.container.Container.prototype.preloadGadgets=function(e,t){var n=t||function(){},i=osapi.container.util.newMetadataRequest(e),r=this;this.refreshService_(),this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_PRELOAD,e),this.service_.getGadgetMetadata(i,function(e){r.addPreloadGadgets_(e),r.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_PRELOADED,e),n(e)})},osapi.container.Container.prototype.unloadGadget=function(e){this.unloadGadgets([e])},osapi.container.Container.prototype.unloadGadgets=function(e){for(var t=0;t<e.length;t++){var n=e[t];this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_UNLOAD,n),delete this.preloadedGadgetUrls_[n],this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_UNLOADED,n)}},osapi.container.Container.prototype.getGadgetMetadata=function(e,t){var n=osapi.container.util.newMetadataRequest([e]);this.refreshService_(),this.service_.getGadgetMetadata(n,t)},osapi.container.Container.prototype.rpcRegister=function(e,t){var n=this;return gadgets.rpc.register(e,function(){this[osapi.container.GadgetSite.RPC_ARG_KEY]=n.getGadgetSiteByIframeId_(this.f);for(var e=[this],i=0;i<arguments.length;++i)e.push(arguments[i]);return t.apply(n,e)})},osapi.container.Container.prototype.onConstructed=function(e){},osapi.container.Container.addMixin=function(e,t){var n=osapi.container.Container.prototype.mixins_;if(n[e]){var i=n[e];n[e]=function(e){return i.call(this,e),t.call(this,e)}}else osapi.container.Container.prototype.mixinsOrder_.push(e),n[e]=t},osapi.container.Container.prototype.mixins_={},osapi.container.Container.prototype.mixinsOrder_=[],osapi.container.Container.prototype.initializeMixins_=function(){for(var e=osapi.container.Container.prototype.mixins_,t=osapi.container.Container.prototype.mixinsOrder_,n=0;n<t.length;n++){var i=t[n];this[i]=new e[i](this)}},osapi.container.Container.prototype.addPreloadGadgets_=function(e,t){var n,i=t||{};for(n in e)if(e[n].error){var r=["Failed to preload gadget ",n,"."].join("");gadgets.warn(r),r=["Detailed error: ",e[n].error.code||""," ",e[n].error.message||""].join(""),gadgets.log(r)}else this.addPreloadedGadgetUrl_(n),e[n][osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]&&this.scheduleRefreshTokens_(i[n]?i[n][osapi.container.TokenResponse.TOKEN_TTL]:e[n][osapi.container.MetadataResponse.TOKEN_TTL])},osapi.container.Container.prototype.preloadCaches=function(e){var t=osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.PRELOAD_METADATAS,{}),n=osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.PRELOAD_TOKENS,{});e=osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.PRELOAD_REF_TIME,null);var i,r=[];for(i in t)t.hasOwnProperty(i)&&r.push(i);this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_PRELOAD,r),this.service_.addGadgetMetadatas(t,e),this.service_.addGadgetTokens(n,e),this.addPreloadGadgets_(t,n),this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_PRELOADED,t)},osapi.container.Container.prototype.refreshService_=function(){var e=this.getActiveGadgetUrls_();this.service_.uncacheStaleGadgetMetadataExcept(e)},osapi.container.Container.prototype.getGadgetSiteByIframeId_=function(e){for(var t in this.sites_){var n=this.sites_[t],i=n.getActiveSiteHolder();if(i&&i.getIframeId()===e)return n}return null},osapi.container.Container.prototype.getSiteById=function(e){return this.sites_[e]},osapi.container.Container.prototype.updateContainerSecurityToken=function(e,t,n){this.service_.updateContainerSecurityToken(e,t,n)},osapi.container.Container.prototype.scheduleRefreshTokens_=function(e){var t=this,n=this.tokenRefreshInterval_,i=e?this.setRefreshTokenInterval_(1e3*e):n,r=function(){function e(n){n?setTimeout(gadgets.util.makeClosure(t,t.updateContainerSecurityToken,e,!0),1):(t.lastRefresh_=osapi.container.util.getCurrentTimeMs(),t.tokenRefreshTimer_=setTimeout(r,i),t.refreshTokens_())}t.updateContainerSecurityToken(e)};!this.isRefreshTokensEnabled_()||this.tokenRefreshTimer_&&i==n||(e=osapi.container.util.getCurrentTimeMs(),this.tokenRefreshTimer_?(n=(this.lastRefresh_||0)+n,n<e&&(n=e+i,i=1),n>e+i&&(clearTimeout(this.tokenRefreshTimer_),this.tokenRefreshTimer_=setTimeout(r,i))):(this.lastRefresh_=e,this.tokenRefreshTimer_=setTimeout(r,i)))},osapi.container.Container.prototype.unscheduleRefreshTokens_=function(){this.tokenRefreshTimer_&&0>=this.getTokenRefreshableGadgetUrls_().length&&(clearTimeout(this.tokenRefreshTimer_),this.tokenRefreshTimer_=null)},osapi.container.Container.prototype.isRefreshTokensEnabled_=function(){return 0<this.tokenRefreshInterval_},osapi.container.Container.prototype.setRefreshTokenInterval_=function(e){if(e){e*=.8;var t=this.tokenRefreshInterval_;return 0>t?t:this.tokenRefreshInterval_=0==t?e:Math.min(t,e)}},osapi.container.Container.prototype.registerRpcServices_=function(){var e=this;this.rpcRegister("resize_iframe",function(e,t){var n=e[osapi.container.GadgetSite.RPC_ARG_KEY];n&&n.setHeight(t)}),this.rpcRegister("resize_iframe_width",function(e,t){var n=e[osapi.container.GadgetSite.RPC_ARG_KEY];return n&&n.setWidth(t),!0}),this.rpcRegister("set_pref",function(t,n,i){var r=t[osapi.container.GadgetSite.RPC_ARG_KEY],a=e.config_[osapi.container.ContainerConfig.SET_PREFERENCES];if(r&&a){for(var o={},s=2,c=arguments.length;s<c;s+=2)o[arguments[s]]=arguments[s+1];a(r.getId(),r.getActiveSiteHolder().getUrl(),o)}})},osapi.container.Container.prototype.setupRpcArbitrator_=function(e){var t=gadgets.config.get("container");if("undefined"!=typeof t.enableRpcArbitration&&t.enableRpcArbitration){if(e=osapi.container.util.getSafeJsonValue(e,osapi.container.ContainerConfig.RPC_ARBITRATOR,null),!e){var n=this;e=function(e,t){var i=n.getGadgetSiteByIframeId_(t);if(i&&i.getActiveSiteHolder()&&(i=n.service_.getCachedGadgetMetadata(i.getActiveSiteHolder().getUrl()),!i.error&&i.rpcServiceIds))for(var r,a=0;r=i.rpcServiceIds[a];a++)if(r==e)return!0;return gadgets.warn("RPC call to "+e+" was not allowed."),!1}}gadgets.rpc.config({arbitrator:e})}},osapi.container.Container.prototype.addPreloadedGadgetUrl_=function(e){this.preloadedGadgetUrls_[e]=null},osapi.container.Container.prototype.getTokenRefreshableGadgetUrls_=function(){var e,t={};for(e in this.getActiveGadgetUrls_())this.service_.getCachedGadgetMetadata(e)[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]&&(t[e]=1);for(var n in this.sites_){var i=this.sites_[n];i instanceof osapi.container.GadgetSite&&(e=i.getActiveSiteHolder())&&(e=e.getUrl(),mid=i.getModuleId(),t[e]&&(t[osapi.container.util.buildTokenRequestUrl(e,mid)]=1))}return osapi.container.util.toArrayOfJsonKeys(t)},osapi.container.Container.prototype.getActiveGadgetUrls_=function(){return osapi.container.util.mergeJsons(this.getNavigatedGadgetUrls_(),this.preloadedGadgetUrls_)},osapi.container.Container.prototype.getNavigatedGadgetUrls_=function(){var e,t={};for(e in this.sites_){var n=this.sites_[e];n instanceof osapi.container.GadgetSite&&(n=n.getActiveSiteHolder())&&(t[n.getUrl()]=1)}return t},osapi.container.Container.prototype.refreshTokens_=function(){var e=this.getTokenRefreshableGadgetUrls_(),e=osapi.container.util.newTokenRequest(e),t=this;this.service_.getGadgetToken(e,function(e){for(var n in t.sites_){var i=t.sites_[n];if(i instanceof osapi.container.GadgetSite){var r=i.getActiveSiteHolder();if(r&&t.service_.getCachedGadgetMetadata(r.getUrl())[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]){var i=i.getModuleId(),i=osapi.container.util.buildTokenRequestUrl(r.getUrl(),i),a=e[i];a.error?gadgets.warn(["Failed to get token for gadget ",i,"."].join("")):gadgets.rpc.call(r.getIframeId(),"update_security_token",null,a[osapi.container.TokenResponse.TOKEN])}}}})},osapi.container.Container.prototype.invalidateAllTokens_=function(){for(var e in this.sites_){var t=this.sites_[e];t instanceof osapi.container.GadgetSite&&(t=t.getActiveSiteHolder(),this.service_.getCachedGadgetMetadata(t.getUrl())[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]=!0)}},osapi.container.Container.prototype.forceRefreshAllTokens=function(){this.invalidateAllTokens_(),this.refreshTokens_()},osapi.container.Container.prototype.applyLifecycleCallbacks_=function(e){var t=Array.prototype.slice.call(arguments,1);for(name in this.gadgetLifecycleCallbacks_){var n=this.gadgetLifecycleCallbacks_[name][e];n&&n.apply(null,t)}},osapi.container.Container.prototype.newUrlSite=function(e){var t={};return t[osapi.container.UrlSite.URL_ELEMENT]=e,e=new osapi.container.UrlSite(this,this.service_,t),this.sites_[e.getId()]=e},osapi.container.Container.prototype.navigateUrl=function(e,t,n){return e.render(t,n),e},gadgets.config.register("container",null,function(e){e=e.container.jsPath||null,window.__CONTAINER_URI=shindig.uri(window.location.href);var t=window.__API_URI=null;if(window.__CONTAINER_SCRIPT_ID)t=document.getElementById(window.__CONTAINER_SCRIPT_ID);else for(var n=document.getElementsByTagName("script"),i=0;n&&i<n.length;i++){var r=n[i].src,a=null!=e&&r&&r.indexOf(e)||-1;if(-1!=a&&/.*container.*[.]js.*[?&]c=1(#|&|$).*/.test(r.substring(a+e.length))){t=n[i];break}}t&&(window.__API_URI=shindig.uri(t.src),window.__API_URI.resolve(window.__CONTAINER_URI)),window.__CONTAINER=window.__API_URI?window.__API_URI.getQP("container"):"default"},!1),osapi.container.Container.addMixin("views",function(e){var t=this;e.rpcRegister("gadgets.views.close",function(n,i){var r=e.getGadgetSiteByIframeId_(n.f),a="undefined"!=typeof i&&null!=i?e.getSiteById(i):r;!a||a!=r&&a.ownerId_!=n.f||t.destroyElement(a)}),e.rpcRegister("gadgets.window.getContainerDimensions",function(e){return e=document.documentElement,{width:e?e.clientWidth:-1,height:e?e.clientHeight:-1}}),this.destroyElement=function(e){console.log("container needs to define destroyElement function")}}),osapi.container.Container.addMixin("views",function(e){this.resultCallbacks_={},this.returnValues_={};var t=this,n={};n[osapi.container.CallbackType.ON_BEFORE_CLOSE]=function(e){var n=e.getId(),i=t.returnValues_[n],r=t.resultCallbacks_[n];"undefined"!=typeof r&&e.ownerId_&&gadgets.rpc.call(e.ownerId_,"gadgets.views.deliverResult",null,r,i),delete t.returnValues_[n],delete t.resultCallbacks_[n]},e.addGadgetLifecycleCallback("open-views",n),e.rpcRegister("gadgets.views.setReturnValue",function(n,i){var r=e.getGadgetSiteByIframeId_(n.f);r&&(t.returnValues_[r.getId()]=i)})}),osapi.container.ee={},osapi.container.ee.RenderParam={GADGET_RENDER_PARAMS:"gadgetRenderParams",GADGET_VIEW_PARAMS:"gadgetViewParams",URL_RENDER_PARAMS:"urlRenderParams",DATA_MODEL:"eeDataModel",EMBEDDED:"embedded"},osapi.container.ee.DataModel={CONTEXT:"context",GADGET:"gadget",URL:"url",PREVIEW_IMAGE:"previewImage",PREFERRED_EXPERIENCE:"preferredExperience"},osapi.container.ee.PreferredExperience={TARGET:"target",DISPLAY:"display",TYPE:"type",VIEW:"view",VIEW_TARGET:"viewTarget"},osapi.container.ee.Context={ASSOCIATED_CONTEXT:"associatedContext",OPENSOCIAL:"openSocial"},osapi.container.ee.AssociatedContext={ID:"id",TYPE:"type",OBJECT_REFERENCE:"objectReference"},osapi.container.ee.TargetType={GADGET:"gadget",URL:"url"},osapi.container.ee.DisplayType={IMAGE:"image",TEXT:"text"},osapi.container.ee.ContainerConfig={GET_EE_NAVIGATION_TYPE:"GET_EE_NAVIGATION_TYPE"},function(){osapi.container.Container.addMixin("ee",function(e){function t(t,s,c,l,d,u){var p=c[osapi.container.ee.RenderParam.GADGET_VIEW_PARAMS]||{},g=c[osapi.container.ee.RenderParam.GADGET_RENDER_PARAMS]||{};g[osapi.container.RenderParam.VIEW]=osapi.container.ee.RenderParam.EMBEDDED;var f=s[i.PREFERRED_EXPERIENCE];if(f&&(f=f[r.TARGET])&&f[r.TYPE]===a.GADGET&&f[r.VIEW]&&(g[osapi.container.RenderParam.VIEW]=f[r.VIEW]),d){var f=s[i.CONTEXT],h=!0;if(f?"object"!=typeof f&&(h=!1):f={},h){h={},h[o.ASSOCIATED_CONTEXT]={};for(var _ in d)d.hasOwnProperty(_)&&(h[_]=d[_]);f[o.OPENSOCIAL]=h,s[i.CONTEXT]=f}}g[osapi.container.ee.RenderParam.DATA_MODEL]=s;var m=e.newGadgetSite(t,u),E=s[i.GADGET];e.preloadGadget(E,function(r){!r[E]||r[E].error?null!=s[i.URL]?n(t,s,c,l):null!=l&&l(m,r[E]||{error:r}):e.navigateGadget(m,E,p,g,function(e){null!=l&&l(m,e)})})}function n(t,n,r,a){r=r[osapi.container.ee.RenderParam.URL_RENDER_PARAMS]||{},t=e.newUrlSite(t),n=e.navigateUrl(t,n[i.URL],r),a&&a(n,null)}var i=osapi.container.ee.DataModel,r=osapi.container.ee.PreferredExperience,a=osapi.container.ee.TargetType,o=osapi.container.ee.Context,s=osapi.container.ee.ContainerConfig;return e.rpcRegister("ee_gadget_rendered",function(e){return(e=e.gs.getActiveSiteHolder().renderParams_.eeDataModel)?e[i.CONTEXT]:null}),{navigate:function(a,o,c,l,d,u){var p=null;e.config_&&e.config_[s.GET_EE_NAVIGATION_TYPE]&&"function"==typeof e.config_[s.GET_EE_NAVIGATION_TYPE]?p=e.config_[s.GET_EE_NAVIGATION_TYPE].call(e,o):o[i.PREFERRED_EXPERIENCE]&&(p=o[i.PREFERRED_EXPERIENCE],p[r.TARGET]&&(p=p[r.TARGET])&&p[r.TYPE]&&(p=p[r.TYPE],osapi.container.ee.TargetType.URL===p&&"undefined"!=typeof o.url||osapi.container.ee.TargetType.GADGET===p&&"undefined"!=typeof o.gadget))||(p=null),null===p&&(o[i.GADGET]?p=osapi.container.ee.TargetType.GADGET:o[i.URL]&&(p=osapi.container.ee.TargetType.URL)),p===osapi.container.ee.TargetType.GADGET?t(a,o,c,l,d,u):p===osapi.container.ee.TargetType.URL&&n(a,o,c,l)},close:function(t){t instanceof osapi.container.GadgetSite&&e.closeGadget(t),t instanceof osapi.container.UrlSite&&t.close()}}})}(),gadgets.json.xml=function(){function e(i,r){for(var a=0;a<i.length;a++){var o=i[a];if(o.nodeType==DOM_TEXT_NODE){var s=o.nodeName,c=r[s];r[s]=null!=c?t(c,o.nodeValue):o.nodeValue}else if(0==o.childNodes.length)if(null!=o.attributes&&0!=o.attributes.length)if(s=o,o=r,c=o[s.nodeName],null==c)o[s.nodeName]={},n(s.attributes,o[s.nodeName]);else{var l={};n(s.attributes,l),o[s.nodeName]=t(c,l)}else r[o.nodeName]=null;else 1!=o.childNodes.length||o.firstChild.nodeType!=DOM_TEXT_NODE||null!=o.attributes&&0!=o.attributes.length?(s=r,c=s[o.nodeName],null==c?(s[o.nodeName]={},null!=o.attributes&&0!=o.attributes.length&&n(o.attributes,s[o.nodeName]),e(o.childNodes,s[o.nodeName])):(l={},null!=o.attributes&&0!=o.attributes.length&&n(o.attributes,l),e(o.childNodes,l),s[o.nodeName]=t(c,l))):(s=o.nodeName,o=o.firstChild,c=r[s],r[s]=null!=c?t(c,o.nodeValue):o.nodeValue)}}function t(e,t){return e instanceof Array?(e[e.length]=t,e):[e,t]}function n(e,t){for(var n=null,i=0;i<e.length;i++)n=e[i],t["@"+n.nodeName]=n.nodeValue}return{convertXmlToJson:function(t){var n={};return e(t.childNodes,n),n}}}();var opensocial=opensocial||{};opensocial.xmlutil=opensocial.xmlutil||{},opensocial.xmlutil.parser_=null,opensocial.xmlutil.parseXML=function(e){if("undefined"!=typeof DOMParser){opensocial.xmlutil.parser_=opensocial.xmlutil.parser_||new DOMParser;var t=opensocial.xmlutil.parser_.parseFromString(e,"text/xml");if(t.firstChild&&"parsererror"==t.firstChild.tagName)throw Error(t.firstChild.firstChild.nodeValue);return t}if("undefined"!=typeof ActiveXObject){if(t=new ActiveXObject("MSXML2.DomDocument"),t.validateOnParse=!1,t.loadXML(e),t.parseError&&t.parseError.errorCode)throw Error(t.parseError.reason);return t}throw Error("No XML parser found in this browser.")},opensocial.xmlutil.NSMAP={os:"http://opensocial.org/"},opensocial.xmlutil.getRequiredNamespaces=function(e,t){var n,i=t?opensocial.xmlutil.getNamespaceDeclarations_(t):{};for(n in opensocial.xmlutil.NSMAP)opensocial.xmlutil.NSMAP.hasOwnProperty(n)&&!i.hasOwnProperty(n)&&0<=e.indexOf("<"+n+":")&&0>e.indexOf("xmlns:"+n+":")&&(i[n]=opensocial.xmlutil.NSMAP[n]);return opensocial.xmlutil.serializeNamespaces_(i)},opensocial.xmlutil.serializeNamespaces_=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(" xmlns:",t,'="',e[t],'"');return n.join("")},opensocial.xmlutil.getNamespaceDeclarations_=function(e){for(var t={},n=0;n<e.attributes.length;n++){var i=e.attributes[n].nodeName;"xmlns:"==i.substring(0,6)&&(t[i.substring(6,i.length)]=e.getAttribute(i))}return t},opensocial.xmlutil.ENTITIES='<!ENTITY nbsp "&#160;">',opensocial.xmlutil.prepareXML=function(e,t){var n=opensocial.xmlutil.getRequiredNamespaces(e,t);return"<!DOCTYPE root ["+opensocial.xmlutil.ENTITIES+']><root xml:space="preserve"'+n+">"+e+"</root>"},osapi.container.Container.addMixin("views",function(e){var t=this;e.rpcRegister("gadgets.views.openEmbeddedExperience",function(n,i,r,a){var o=n.callback,s=n.f,c=r.gadget;if("string"==typeof r)if((n=/^<(embed)>/i.exec(r))&&n[1])try{var l=gadgets.json.xml.convertXmlToJson(opensocial.xmlutil.parseXML(r));r=l&&l[n[1]]||r}catch(d){}else try{r=(l=gadgets.json.parse(r))||r}catch(u){}var p=function(n){function c(n){var a={};a[osapi.container.RenderParam.VIEW]=osapi.container.ee.RenderParam.EMBEDDED,a[osapi.container.RenderParam.WIDTH]="100%",a[osapi.container.RenderParam.HEIGHT]="100%";var c={};c[osapi.container.RenderParam.WIDTH]="100%",c[osapi.container.RenderParam.HEIGHT]="100%";var l={};l[osapi.container.ee.RenderParam.GADGET_RENDER_PARAMS]=a,l[osapi.container.ee.RenderParam.URL_RENDER_PARAMS]=c,l[osapi.container.ee.RenderParam.GADGET_VIEW_PARAMS]=u,e.ee.navigate(n,r,l,function(e,n){e.ownerId_=s,n&&(t.resultCallbacks_[e.getId()]=i),o&&o([e.getId(),n])},f)}var l,d="",u={};a&&(a.viewTarget&&(d=a.viewTarget),a.viewParams&&(u=a.viewParams),a.coordinates&&(l=a.coordinates));var p=e.getGadgetSiteByIframeId_(s),g=p.getActiveSiteHolder().getIframeElement(),f=t.getContainerAssociatedContext(r,n);(n=t.createElementForEmbeddedExperience(g,n,d,l,p,c))&&c(n)};c?e.preloadGadget(c,function(e){e[c]&&!e[c].error||r.url?p(e[c]):null!=o&&o([null,e[c]||{error:e}])}):p()}),this.createElementForEmbeddedExperience=function(e,t,n,i,r,a){console.log("container needs to define createElementForEmbeddedExperience function")},this.getContainerAssociatedContext=function(e,t){return null}}),osapi.container.Container.addMixin("views",function(e){var t=this;e.rpcRegister("gadgets.views.openGadget",function(n,i,r){var a=n.callback,o=n.f,s="",c=e.getGadgetSiteByIframeId_(n.f);"undefined"!=typeof c&&"undefined"!=typeof c.getActiveSiteHolder()&&(s=c.getActiveSiteHolder().getUrl());var l,d="",u="",p={};r&&(r.view&&(d=r.view),r.viewTarget&&(u=r.viewTarget),r.viewParams&&(p=r.viewParams),r.coordinates&&(l=r.coordinates));var g=e.getGadgetSiteByIframeId_(n.f).getActiveSiteHolder().getIframeElement();e.preloadGadget(s,function(n){function r(n){var r={},c=e.newGadgetSite(n);c.ownerId_=o,"undefined"!=typeof d&&""!==d&&(r[osapi.container.RenderParam.VIEW]=d),r[osapi.container.RenderParam.WIDTH]="100%",r[osapi.container.RenderParam.HEIGHT]="100%",e.navigateGadget(c,s,p,r,function(e){e&&(t.resultCallbacks_[c.getId()]=i),a&&a([c.getId(),e])})}var f={};if("undefined"!=typeof n&&"undefined"!=typeof n[s]){if(n[s].error)return gadgets.error("Failed to preload gadget : "+s),void(null!=a&&a([null,n[s]]));f=n[s]}(n=t.createElementForGadget(f,g,d,u,l,c,r))&&r(n)})}),this.createElementForGadget=function(e,t,n,i,r,a,o){console.log("container needs to define createElementForGadget function")}}),osapi.container.Container.addMixin("views",function(e){var t=this;e.rpcRegister("gadgets.views.openUrl",function(n,i,r,a){function o(t){t=e.newUrlSite(t);var r={};r[osapi.container.RenderParam.WIDTH]="100%",r[osapi.container.RenderParam.HEIGHT]="100%",e.navigateUrl(t,i,r),t.ownerId_=n.f,n.callback([t.getId()])}var s=e.getGadgetSiteByIframeId_(n.f),c=s.getActiveSiteHolder().getIframeElement();(r=t.createElementForUrl(c,r,a,s,o))&&o(r)}),this.createElementForUrl=function(e,t,n,i,r){console.log("container needs to define createElementForUrl function")}}),"undefined"!=typeof osapi&&(osapi.container.UrlSite.prototype.render=function(e,t){this.holder_=new osapi.container.UrlHolder(this,this.el_,t?t.onLoad:null);var n,i={};for(n in t)i[n]=t[n];this.holder_.render(e,i)}),gadgets.config.init({opensocial:{invalidatePath:"//%host%/portal/rpc",path:"//%host%/portal/rpc",domain:"shindig",supportedFields:{person:["id",{name:["familyName","givenName","unstructured"]},"thumbnailUrl","profileUrl"],mediaItem:"album_id created description duration file_size id language last_updated location mime_type num_comments num_views num_votes rating start_time tagged_people tags thumbnail_url title type url".split(" "),album:"id thumbnailUrl title description location ownerId".split(" "),group:["id","title","description"],activity:"appId body bodyId externalId id mediaItems postedTime priority streamFaviconUrl streamSourceUrl streamTitle streamUrl templateParams title url userId".split(" "),activityEntry:"actor content generator icon id object published provider target title updated url verb openSocial extensions".split(" ")},enableCaja:!1},rpc:{commSwf:"/xpc.swf",passReferrer:"c2p:query",parentRelayUrl:"/container/rpc_relay.html",useLegacyProtocol:!1},"shindig.auth":{authToken:"-1:-1:*:*:*:0:default"},container:{jsPath:"/portal/gadgets/js",relayPath:"/portal/gadgets/files/container/rpc_relay.html",enableRpcArbitration:!1},views:{"default":{isOnlyVisible:!1,urlTemplate:"http://localhost/portal/gadgets/default?{var}",aliases:["home","profile","canvas"]},canvas:{isOnlyVisible:!0,urlTemplate:"http://localhost/portal/gadgets/canvas?{var}",aliases:["FULL_PAGE"]},embedded:{isOnlyVisible:!1,urlTemplate:"http://localhost/portal/gadgets/embedded?{var}",aliases:["embedded"]},profile:{isOnlyVisible:!1,urlTemplate:"http://localhost/portal/gadgets/profile?{var}",aliases:["DASHBOARD","default"]}},osapi:{endPoints:["//%host%/portal/rpc"]},"osapi.services":{"gadgets.rpc":["container.listMethods"]},"core.io":{unparseableCruft:"throw 1; < don't be evil' >",jsonProxyUrl:"//%host%/portal/gadgets/makeRequest",jsPath:"/portal/gadgets/js",proxyUrl:"//%host%/portal/gadgets/proxy%filename%?container=%container%&refresh=%refresh%&url=%url%%authz%%rewriteMime%",xhrPollIntervalMs:50}}),window.___jsl.l=(window.___jsl.l||[]).concat(["container","open-views","portal"]);var requirejs,require,define;!function(ba){function G(e){return"[object Function]"===K.call(e)}function H(e){return"[object Array]"===K.call(e)}function v(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function T(e,t){if(e){var n;for(n=e.length-1;-1<n&&(!e[n]||!t(e[n],n,e));n-=1);}}function t(e,t){return fa.call(e,t)}function m(e,n){return t(e,n)&&e[n]}function B(e,n){for(var i in e)if(t(e,i)&&n(e[i],i))break}function U(e,n,i,r){return n&&B(n,function(n,a){!i&&t(e,a)||(!r||"object"!=typeof n||!n||H(n)||G(n)||n instanceof RegExp?e[a]=n:(e[a]||(e[a]={}),U(e[a],n,i,r)))}),e}function u(e,t){return function(){return t.apply(e,arguments)}}function ca(e){throw e}function da(e){if(!e)return e;var t=ba;return v(e.split("."),function(e){t=t[e]}),t}function C(e,t,n,i){return t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e),t.requireType=e,t.requireModules=i,n&&(t.originalError=n),t}function ga(e){function n(e,t,n){var i,r,a,o,s,c,l,d,t=t&&t.split("/"),u=A.map,p=u&&u["*"];if(e){for(e=e.split("/"),r=e.length-1,A.nodeIdCompat&&Q.test(e[r])&&(e[r]=e[r].replace(Q,"")),"."===e[0].charAt(0)&&t&&(r=t.slice(0,t.length-1),e=r.concat(e)),r=e,a=0;a<r.length;a++)o=r[a],"."===o?(r.splice(a,1),a-=1):".."===o&&0!==a&&(1!=a||".."!==r[2])&&".."!==r[a-1]&&0<a&&(r.splice(a-1,2),a-=2);e=e.join("/")}if(n&&u&&(t||p)){r=e.split("/"),a=r.length;e:for(;0<a;a-=1){if(s=r.slice(0,a).join("/"),t)for(o=t.length;0<o;o-=1)if((n=m(u,t.slice(0,o).join("/")))&&(n=m(n,s))){i=n,c=a;break e}!l&&p&&m(p,s)&&(l=m(p,s),d=a)}!i&&l&&(i=l,c=d),i&&(r.splice(0,c,i),e=r.join("/"))}return(i=m(A.pkgs,e))?i:e}function i(e){z&&v(document.getElementsByTagName("script"),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===S.contextName)return t.parentNode.removeChild(t),!0})}function r(e){var t=m(A.paths,e);if(t&&H(t)&&1<t.length)return t.shift(),S.require.undef(e),S.makeRequire(null,{skipMap:!0})([e]),!0}function a(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function o(e,t,i,r){var o,s,c=null,l=t?t.name:null,d=e,u=!0,p="";return e||(u=!1,e="_@r"+(q+=1)),e=a(e),c=e[0],e=e[1],c&&(c=n(c,l,r),s=m(L,c)),e&&(c?p=s&&s.normalize?s.normalize(e,function(e){return n(e,l,r)}):-1===e.indexOf("!")?n(e,l,r):e:(p=n(e,l,r),e=a(p),c=e[0],p=e[1],i=!0,o=S.nameToUrl(p))),i=!c||s||i?"":"_unnormalized"+(V+=1),{prefix:c,name:p,parentMap:t,unnormalized:!!i,url:o,originalName:d,isDefine:u,id:(c?c+"!"+p:p)+i}}function s(e){var t=e.id,n=m(P,t);return n||(n=P[t]=new S.Module(e)),n}function c(e,n,i){var r=e.id,a=m(P,r);!t(L,r)||a&&!a.defineEmitComplete?(a=s(e),a.error&&"error"===n?i(a.error):a.on(n,i)):"defined"===n&&i(L[r])}function l(e,t){var n=e.requireModules,i=!1;t?t(e):(v(n,function(t){(t=m(P,t))&&(t.error=e,t.events.error&&(i=!0,t.emit("error",e)))}),i||g.onError(e))}function d(){R.length&&(ha.apply(k,[k.length,0].concat(R)),R=[])}function p(e){delete P[e],delete x[e]}function f(e,t,n){var i=e.map.id;e.error?e.emit("error",e.error):(t[i]=!0,v(e.depMaps,function(i,r){var a=i.id,o=m(P,a);o&&!e.depMatched[r]&&!n[a]&&(m(t,a)?(e.defineDep(r,L[a]),e.check()):f(o,t,n))}),n[i]=!0)}function h(){var e,t,n=(e=1e3*A.waitSeconds)&&S.startTime+e<(new Date).getTime(),a=[],o=[],s=!1,c=!0;if(!w){if(w=!0,B(x,function(e){var l=e.map,d=l.id;if(e.enabled&&(l.isDefine||o.push(e),!e.error))if(!e.inited&&n)r(d)?s=t=!0:(a.push(d),i(d));else if(!e.inited&&e.fetched&&l.isDefine&&(s=!0,!l.prefix))return c=!1}),n&&a.length)return e=C("timeout","Load timeout for modules: "+a,null,a),
    e.contextName=S.contextName,l(e);c&&v(o,function(e){f(e,{},{})}),n&&!t||!s||!z&&!ea||O||(O=setTimeout(function(){O=0,h()},50)),w=!1}}function _(e){t(L,e[0])||s(o(e[0],null,!0)).init(e[1],e[2])}function E(e){var e=e.currentTarget||e.srcElement,t=S.onScriptLoad;return e.detachEvent&&!Y?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=S.onScriptError,(!e.detachEvent||Y)&&e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function y(){var e;for(d();k.length;){if(e=k.shift(),null===e[0])return l(C("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));_(e)}}var w,b,S,I,O,A={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},P={},x={},D={},k=[],L={},j={},F={},q=1,V=1;return I={require:function(e){return e.require?e.require:e.require=S.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?L[e.map.id]=e.exports:e.exports=L[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return m(A.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=m(D,e.id)||{},this.map=e,this.shim=m(A.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,n,i){i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=u(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,S.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();S.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;j[e]||(j[e]=!0,S.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id;t=this.depExports;var i=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,1>this.depCount&&!this.defined){if(G(r)){if(this.events.error&&this.map.isDefine||g.onError!==ca)try{i=S.execCb(n,r,t,i)}catch(a){e=a}else i=S.execCb(n,r,t,i);if(this.map.isDefine&&void 0===i&&((t=this.module)?i=t.exports:this.usingExports&&(i=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e)}else i=r;this.exports=i,this.map.isDefine&&!this.ignore&&(L[n]=i,g.onResourceLoad)&&g.onResourceLoad(S,this.map,this.depMaps),p(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,i=e.id,r=o(e.prefix);this.depMaps.push(r),c(r,"defined",u(this,function(r){var a,d;d=m(F,this.map.id);var f=this.map.name,h=this.map.parentMap?this.map.parentMap.name:null,_=S.makeRequire(e.parentMap,{enableBuildCallback:!0});this.map.unnormalized?(r.normalize&&(f=r.normalize(f,function(e){return n(e,h,!0)})||""),r=o(e.prefix+"!"+f,this.map.parentMap),c(r,"defined",u(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),(d=m(P,r.id))&&(this.depMaps.push(r),this.events.error&&d.on("error",u(this,function(e){this.emit("error",e)})),d.enable())):d?(this.map.url=S.nameToUrl(d),this.load()):(a=u(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),a.error=u(this,function(e){this.inited=!0,this.error=e,e.requireModules=[i],B(P,function(e){0===e.map.id.indexOf(i+"_unnormalized")&&p(e.map.id)}),l(e)}),a.fromText=u(this,function(n,r){var c=e.name,d=o(c),u=M;r&&(n=r),u&&(M=!1),s(d),t(A.config,i)&&(A.config[c]=A.config[i]);try{g.exec(n)}catch(p){return l(C("fromtexteval","fromText eval for "+i+" failed: "+p,p,[i]))}u&&(M=!0),this.depMaps.push(d),S.completeLoad(c),_([c],a)}),r.load(e.name,_,a,A))})),S.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){x[this.map.id]=this,this.enabling=this.enabled=!0,v(this.depMaps,u(this,function(e,n){var i,r;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[n]=e,i=m(I,e.id))return void(this.depExports[n]=i(this));this.depCount+=1,c(e,"defined",u(this,function(e){this.defineDep(n,e),this.check()})),this.errback&&c(e,"error",u(this,this.errback))}i=e.id,r=P[i],!t(I,i)&&r&&!r.enabled&&S.enable(e,this)})),B(this.pluginMaps,u(this,function(e){var t=m(P,e.id);t&&!t.enabled&&S.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){v(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},S={config:A,contextName:e,registry:P,defined:L,urlFetched:j,defQueue:k,Module:b,makeModuleMap:o,nextTick:g.nextTick,onError:l,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=A.shim,n={paths:!0,bundles:!0,config:!0,map:!0};B(e,function(e,t){n[t]?(A[t]||(A[t]={}),U(A[t],e,!0,!0)):A[t]=e}),e.bundles&&B(e.bundles,function(e,t){v(e,function(e){e!==t&&(F[e]=t)})}),e.shim&&(B(e.shim,function(e,n){H(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=S.makeShimExports(e)),t[n]=e}),A.shim=t),e.packages&&v(e.packages,function(e){var t,e="string"==typeof e?{name:e}:e;t=e.name,e.location&&(A.paths[t]=e.location),A.pkgs[t]=e.name+"/"+(e.main||"main").replace(ia,"").replace(Q,"")}),B(P,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=o(t))}),(e.deps||e.callback)&&S.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(ba,arguments)),t||e.exports&&da(e.exports)}},makeRequire:function(r,a){function c(n,i,d){var u,p;return a.enableBuildCallback&&i&&G(i)&&(i.__requireJsBuild=!0),"string"==typeof n?G(i)?l(C("requireargs","Invalid require call"),d):r&&t(I,n)?I[n](P[r.id]):g.get?g.get(S,n,r,c):(u=o(n,r,!1,!0),u=u.id,t(L,u)?L[u]:l(C("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(r?"":". Use require([])")))):(y(),S.nextTick(function(){y(),p=s(o(null,r)),p.skipMap=a.skipMap,p.init(n,i,d,{enabled:!0}),h()}),c)}return a=a||{},U(c,{isBrowser:z,toUrl:function(e){var t,i=e.lastIndexOf("."),a=e.split("/")[0];return-1!==i&&("."!==a&&".."!==a||1<i)&&(t=e.substring(i,e.length),e=e.substring(0,i)),S.nameToUrl(n(e,r&&r.id,!0),t,!0)},defined:function(e){return t(L,o(e,r,!1,!0).id)},specified:function(e){return e=o(e,r,!1,!0).id,t(L,e)||t(P,e)}}),r||(c.undef=function(e){d();var t=o(e,r,!0),n=m(P,e);i(e),delete L[e],delete j[t.url],delete D[e],T(k,function(t,n){t[0]===e&&k.splice(n,1)}),n&&(n.events.defined&&(D[e]=n.events),p(e))}),c},enable:function(e){m(P,e.id)&&s(e).enable()},completeLoad:function(e){var n,i,a=m(A.shim,e)||{},o=a.exports;for(d();k.length;){if(i=k.shift(),null===i[0]){if(i[0]=e,n)break;n=!0}else i[0]===e&&(n=!0);_(i)}if(i=m(P,e),!n&&!t(L,e)&&i&&!i.inited){if(A.enforceDefine&&(!o||!da(o)))return r(e)?void 0:l(C("nodefine","No define call for "+e,null,[e]));_([e,a.deps||[],a.exportsFn])}h()},nameToUrl:function(e,t,n){var i,r,a;if((i=m(A.pkgs,e))&&(e=i),i=m(F,e))return S.nameToUrl(i,t,n);if(g.jsExtRegExp.test(e))i=e+(t||"");else{for(i=A.paths,e=e.split("/"),r=e.length;0<r;r-=1)if(a=e.slice(0,r).join("/"),a=m(i,a)){H(a)&&(a=a[0]),e.splice(0,r,a);break}i=e.join("/"),i+=t||(/^data\:|\?/.test(i)||n?"":".js"),i=("/"===i.charAt(0)||i.match(/^[\w\+\.\-]+:/)?"":A.baseUrl)+i}return A.urlArgs?i+((-1===i.indexOf("?")?"?":"&")+A.urlArgs):i},load:function(e,t){g.load(S,e,t)},execCb:function(e,t,n,i){return t.apply(i,n)},onScriptLoad:function(e){("load"===e.type||ja.test((e.currentTarget||e.srcElement).readyState))&&(N=null,e=E(e),S.completeLoad(e.id))},onScriptError:function(e){var t=E(e);if(!r(t.id))return l(C("scripterror","Script error for: "+t.id,e,[t.id]))}},S.require=S.makeRequire(),S}var g,x,y,D,I,E,N,J,s,O,ka=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,la=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,Q=/\.js$/,ia=/^\.\//;x=Object.prototype;var K=x.toString,fa=x.hasOwnProperty,ha=Array.prototype.splice,z=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),ea=!z&&"undefined"!=typeof importScripts,ja=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Y="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),F={},q={},R=[],M=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(G(requirejs))return;q=requirejs,requirejs=void 0}"undefined"!=typeof require&&!G(require)&&(q=require,require=void 0),g=requirejs=function(e,t,n,i){var r,a="_";return!H(e)&&"string"!=typeof e&&(r=e,H(t)?(e=t,t=n,n=i):e=[]),r&&r.context&&(a=r.context),(i=m(F,a))||(i=F[a]=g.s.newContext(a)),r&&i.configure(r),i.require(e,t,n)},g.config=function(e){return g(e)},g.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=g),g.version="2.1.15",g.jsExtRegExp=/^\/|:|\?|\.js$/,g.isBrowser=z,x=g.s={contexts:F,newContext:ga},g({}),v(["toUrl","undef","defined","specified"],function(e){g[e]=function(){var t=F._;return t.require[e].apply(t,arguments)}}),z&&(y=x.head=document.getElementsByTagName("head")[0],D=document.getElementsByTagName("base")[0])&&(y=x.head=D.parentNode),g.onError=ca,g.createNode=function(e){var t=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return t.type=e.scriptType||"text/javascript",t.charset="utf-8",t.async=!0,t},g.load=function(e,t,n){var i=e&&e.config||{};if(z)return i=g.createNode(i,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&0>i.attachEvent.toString().indexOf("[native code")||Y?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(M=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,J=i,D?y.insertBefore(i,D):y.appendChild(i),J=null,i;if(ea)try{importScripts(n),e.completeLoad(t)}catch(r){e.onError(C("importscripts","importScripts failed for "+t+" at "+n,r,[t]))}},z&&!q.skipDataMain&&T(document.getElementsByTagName("script"),function(e){if(y||(y=e.parentNode),I=e.getAttribute("data-main"))return s=I,q.baseUrl||(E=s.split("/"),s=E.pop(),O=E.length?E.join("/")+"/":"./",q.baseUrl=O),s=s.replace(Q,""),g.jsExtRegExp.test(s)&&(s=I),q.deps=q.deps?q.deps.concat(s):[s],!0}),define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),H(t)||(n=t,t=null),!t&&G(n)&&(t=[],n.length&&(n.toString().replace(ka,"").replace(la,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),M&&((i=J)||(N&&"interactive"===N.readyState||T(document.getElementsByTagName("script"),function(e){if("interactive"===e.readyState)return N=e}),i=N),i&&(e||(e=i.getAttribute("data-requiremodule")),r=F[i.getAttribute("data-requirecontext")])),(r?r.defQueue:R).push([e,t,n])},define.amd={jQuery:!0},g.exec=function(b){return eval(b)},g(q)}}(this),window.baseUrl=window.baseUrl?window.baseUrl:"/portal";var config={baseUrl:window.baseUrl,paths:{jquery:"trd/jquery/jquery-1.11.2.min",jqueryui:"trd/jquery-ui/jquery-ui",knockout:"trd/knockout/knockout-3.2.0.debug",jquerycookie:"trd/jquery-cookie/jquery-cookie",bootstrap:"trd/bootstrap/js/bootstrap.min",react:"trd/react/react",director:"trd/director/director",pubsub:"trd/pubsub/pubsub",Layout:"js/ext/Layouts",messenger:"components/messenger",interactor:"components/interactor",jsext:"components/jsext",Toolbar:"js/ext/Toolbar",viewutil:"components/viewutil",text:"trd/requirejs/text",css:"trd/requirejs/css",art:"trd/artTemplate/template"},shim:{bootstrap:{deps:[],exports:"bootstrap"},jqueryui:{deps:[],exports:"jqueryui"},jquerycookie:{deps:[],exports:"jquerycookie"},interactor:{deps:["messenger"]},viewutil:{deps:["messenger","interactor"],exports:"viewutil"}}};require.config(config);var contextRoot=config.baseUrl.replace(/.$/gi,"");window.ContainerConfig=window.ContainerConfig||{},"undefined"!=typeof osapi&&(ContainerConfig[osapi.container.ServiceConfig.API_PATH]=contextRoot+"/rpc",ContainerConfig[osapi.container.ContainerConfig.RENDER_DEBUG]="1",ContainerConfig[osapi.container.ContainerConfig.GET_CONTAINER_TOKEN]=function(e){e("john.doe:john.doe:appid:cont:url:0:default",10)});var WidgetEditTool=React.createClass({name:"WidgetEditTool",displayName:"WidgetEditTool",getInitialState:function(){return{}},render:function(){return React.createElement("ul",{className:"list-unstyled edit"},React.createElement("li",null,React.createElement("button",{className:"btn btn-round btn-default btn-outline btn-pill-left","data-type":"edit","data-toggle":"modal","data-target":"#modalBlue"},React.createElement("i",{"aria-hidden":"true",className:"icon wb-pencil"}),"编辑")),React.createElement("li",null,React.createElement("button",{className:"btn btn-default btn-outline","data-type":"del"},"删除")),React.createElement("li",null,React.createElement("button",{className:"btn btn-default btn-outline","data-type":"collage"},React.createElement("i",{className:"icon wb-menu"}))),React.createElement("li",null,React.createElement("button",{className:"btn btn-round btn-default btn-outline btn-pill-right","data-type":"window"},React.createElement("i",{className:"icon wb-fullscreen"}))))}}),Widget=React.createClass({name:"Widget",displayName:"Widget",getWidgetMeta:function(){return this.props.layoutContext.layoutMeta[this.props.gadgetURL]},getInitialState:function(){var e=this.getWidgetMeta(),t=this.props.view;t||(t="default");var n="loading...",n=e.error?e.error.message:e.contents[t];return{html:n}},componentWillMount:function(){},componentDidMount:function(){if(!this.state.html){var e=this.getWidgetMeta(),t="default";if($.each(e.views,function(e,n){return t=e,!1}),"default"!=t){var n=this.props.layoutContext.container;n.renderGadget(e.iframeUrls[t],this.props.id,"url")}else n=this.props.layoutContext.container,n.renderGadget(this.props.gadgetURL,this.props.id)}this.isMounted()&&this.state.html&&(e=$.parseHTML(this.state.html,!0))&&this.domManip(e),this.setPubSub()},componentWillUnmount:function(){},setPubSub:function(){this.state.html&&ReactDOM.findDOMNode(this)},setWidgetEditTool:function(){return this.props.layoutContext.options.isWidgetEdit?React.createElement(WidgetEditTool,null):""},render:function(){var e=!1,t=this.getWidgetMeta();if(!this.state.html){var t=this.getWidgetMeta(),n="default";$.each(t.views,function(e,t){return n=e,!1}),"default"!=n&&(e=!0)}return React.createElement("div",null,React.createElement("div",{id:"gadget-site-"+this.props.id,"data-id":this.props.id,className:this.props.layoutContext.options.isSortable?"well sort":"unsortable"},this.props.layoutContext.options.isShowWidgetName?React.createElement("h5",null,t.modulePrefs.title):"",React.createElement("div",{id:"gadget-site-content-"+this.props.id,className:e?"innerHtml-ipad collapse in":"innerHtml collapse in",dangerouslySetInnerHTML:{__html:this.state.html}}),this.setWidgetEditTool()))},domManip:function(e){var t,n,i=0;if(n=this.getAll(e,"script"),e=n.length)for(var r=/^$|\/(?:java|ecma)script/i,a=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,i=0;i<e;i++)if(t=n[i],r.test(t.type||"")&&!jQuery._data(t,"globalEval"))if(t.src){if(jQuery._evalUrl){if(t=t.src,window.baseUrl&&-1==t.indexOf(window.baseUrl)){t=t.split("//");var o=t[1].indexOf("/");t=t[0]+"//"+t[1].substring(0,o)+window.baseUrl+t[1].substring(o,t[1].length)}jQuery._evalUrl(t)}}else jQuery.globalEval((t.text||t.textContent||t.innerHTML||"").replace(a,""))},getAll:function(e,t){var n,i,r=0,a="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):void 0;if(!a)for(a=[],n=e.childNodes||e;null!=(i=n[r]);r++)!t||jQuery.nodeName(i,t)?a.push(i):jQuery.merge(a,this.getAll(i,t));return void 0===t||t&&jQuery.nodeName(e,t)?jQuery.merge([e],a):a}}),WidgetBox=React.createClass({displayName:"WidgetBox",getInitialState:function(){return{gridData:[]}},componentDidMount:function(){var e=ReactDOM.findDOMNode(this);this.setWidgetDrag(e)},setWidgetDrag:function(e){this.props.layoutContext.options.isSortable&&$(e).sortable({connectWith:".widgetBox",forcePlaceholderSize:!0,placeholder:"ui-portlet-placeholder",stop:function(e){},over:function(){}})},render:function(){var e=this.props.id;return React.createElement("div",{id:this.props.id,key:this.props.id,className:"widgetBox connectedSortable"},React.Children.map(this.props.children,function(t){if(t.type.displayName&&"Widget"===t.type.displayName)return React.createElement(Widget,{id:t.props.id,key:t.props.id,className:t.props.className+" ui-sortable-handle",layoutContext:t.props.layoutContext,gadgetURL:t.props.gadgetURL,widgetBoxId:e})}))}});